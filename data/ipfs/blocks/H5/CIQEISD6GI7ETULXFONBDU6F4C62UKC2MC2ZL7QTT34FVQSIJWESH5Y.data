"sub","mul","pow","div","addN","subN","mulN","sqrN"];function gl(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function yl(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<=tl)throw new Error("Expected Field ORDER > 0, got ".concat(e));const{nBitLength:i,nByteLength:o}=gl(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=dl(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:Qc(i),ZERO:tl,ONE:nl,create:t=>cl(t,e),isValid:t=>{if("bigint"!==typeof t)throw new Error("Invalid field element: expected bigint, got ".concat(typeof t));return tl<=t&&t<e},is0:e=>e===tl,isOdd:e=>(e&nl)===nl,neg:t=>cl(-t,e),eql:(e,t)=>e===t,sqr:t=>cl(t*t,e),add:(t,n)=>cl(t+n,e),sub:(t,n)=>cl(t-n,e),mul:(t,n)=>cl(t*n,e),pow:(e,t)=>function(e,t,n){if(n<tl)throw new Error("Expected power > 0");if(n===tl)return e.ONE;if(n===nl)return t;let r=e.ONE,i=t;for(;n>tl;)n&nl&&(r=e.mul(r,i)),i=e.sqr(i),n>>=nl;return r}(a,e,t),div:(t,n)=>cl(t*hl(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>hl(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?qc(e,o):Hc(e,o),fromBytes:e=>{if(e.length!==o)throw new Error("Fp.fromBytes: expected ".concat(o,", got ").concat(e.length));return n?Vc(e):zc(e)}});return Object.freeze(a)}function ml(e){if("bigint"!==typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function vl(e){const t=ml(e);return t+Math.ceil(t/2)}const bl=BigInt(0),wl=BigInt(1);function El(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>bl;)n&wl&&(r=r.add(i)),i=i.double(),n>>=wl;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,l=e.BASE;const u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&u);o>>=d,r>a&&(r-=h,o+=wl);const s=t,f=t+Math.abs(r)-1,p=e%2!==0,g=r<0;0===r?l=l.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:l}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}function Al(e){return function(e){const t=pl.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});el(e,t)}(e.Fp),el(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gl(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const Sl=BigInt(0),_l=BigInt(1),Il=BigInt(2),Cl=BigInt(8),Tl={zip215:!0};function kl(e){const t=function(e){const t=Al(e);return el(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:c}=t,l=Il<<BigInt(8*a)-_l,u=n.create,h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(r){return{isValid:!1,value:Sl}}}),d=t.adjustScalarBytes||(e=>e),f=t.domain||((e,t,n)=>{if(t.length||n)throw new Error("Contexts/pre-hash are not supported");return e}),p=e=>"bigint"===typeof e&&Sl<e,g=(e,t)=>p(e)&&p(t)&&e<t,y=e=>e===Sl||g(e,l);function m(e,t){if(g(e,t))return e;throw new Error("Expected valid scalar < ".concat(t,", got ").concat(typeof e," ").concat(e))}function v(e){return e===Sl?e:m(e,r)}const b=new Map;function w(e){if(!(e instanceof E))throw new Error("ExtendedPoint expected")}class E{constructor(e,t,n,r){if(this.ex=e,this.ey=t,this.ez=n,this.et=r,!y(e))throw new Error("x required");if(!y(t))throw new Error("y required");if(!y(n))throw new Error("z required");if(!y(r))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof E)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};if(!y(t)||!y(n))throw new Error("invalid affine point");return new E(t,n,_l,u(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(E.fromAffine)}_setWindowSize(e){this._WINDOW_SIZE=e,b.delete(this)}assertValidity(){const{a:e,d:n}=t;if(this.is0())throw new Error("bad point: ZERO");const{ex:r,ey:i,ez:o,et:s}=this,a=u(r*r),c=u(i*i),l=u(o*o),h=u(l*l),d=u(a*e);if(u(l*u(d+c))!==u(h+u(n*u(a*c))))throw new Error("bad point: equation left != right (1)");if(u(r*i)!==u(o*s))throw new Error("bad point: equation left != right (2)")}equals(e){w(e);const{ex:t,ey:n,ez:r}=this,{ex:i,ey:o,ez:s}=e,a=u(t*s),c=u(i*r),l=u(n*s),h=u(o*r);return a===c&&l===h}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:i}=this,o=u(n*n),s=u(r*r),a=u(Il*u(i*i)),c=u(e*o),l=n+r,h=u(u(l*l)-o-s),d=c+s,f=d-a,p=c-s,g=u(h*f),y=u(d*p),m=u(h*p),v=u(f*d);return new E(g,y,v,m)}add(e){w(e);const{a:n,d:r}=t,{ex:i,ey:o,ez:s,et:a}=this,{ex:c,ey:l,ez:h,et:d}=e;if(n===BigInt(-1)){const e=u((o-i)*(l+c)),t=u((o+i)*(l-c)),n=u(t-e);if(n===Sl)return this.double();const r=u(s*Il*d),f=u(a*Il*h),p=f+r,g=t+e,y=f-r,m=u(p*n),v=u(g*y),b=u(p*y),w=u(n*g);return new E(m,v,w,b)}const f=u(i*c),p=u(o*l),g=u(a*r*d),y=u(s*h),m=u((i+o)*(c+l)-f-p),v=y-g,b=y+g,A=u(p-n*f),S=u(m*v),_=u(b*A),I=u(m*A),C=u(v*b);return new E(S,_,C,I)}subtract(e){return this.add(e.negate())}wNAF(e){return _.wNAFCached(this,b,e,E.normalizeZ)}multiply(e){const{p:t,f:n}=this.wNAF(m(e,r));return E.normalizeZ([t,n])[0]}multiplyUnsafe(e){let t=v(e);return t===Sl?S:this.equals(S)||t===_l?this:this.equals(A)?this.wNAF(t).p:_.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,r).is0()}toAffine(e){const{ex:t,ey:r,ez:i}=this,o=this.is0();null==e&&(e=o?Cl:n.inv(i));const s=u(t*e),a=u(r*e),c=u(i*e);if(o)return{x:Sl,y:_l};if(c!==_l)throw new Error("invZ was invalid");return{x:s,y:a}}clearCofactor(){const{h:e}=t;return e===_l?this:this.multiplyUnsafe(e)}static fromHex(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{d:i,a:o}=t,s=n.BYTES,a=(e=Gc("pointHex",e,s)).slice(),c=e[s-1];a[s-1]=-129&c;const d=Vc(a);d===Sl||m(d,r?l:n.ORDER);const f=u(d*d),p=u(f-_l),g=u(i*f-o);let{isValid:y,value:v}=h(p,g);if(!y)throw new Error("Point.fromHex: invalid y coordinate");const b=(v&_l)===_l,w=0!==(128&c);if(!r&&v===Sl&&w)throw new Error("Point.fromHex: x=0 and x_0=1");return w!==b&&(v=u(-v)),E.fromAffine({x:v,y:d})}static fromPrivateKey(e){return T(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=qc(t,n.BYTES);return r[r.length-1]|=e&_l?128:0,r}toHex(){return Kc(this.toRawBytes())}}E.BASE=new E(t.Gx,t.Gy,_l,u(t.Gx*t.Gy)),E.ZERO=new E(Sl,_l,_l,Sl);const{BASE:A,ZERO:S}=E,_=El(E,8*a);function I(e){return cl(e,r)}function C(e){return I(Vc(e))}function T(e){const t=a;e=Gc("private key",e,t);const n=Gc("hashed private key",o(e),2*t),r=d(n.slice(0,t)),i=n.slice(t,2*t),s=C(r),c=A.multiply(s),l=c.toRawBytes();return{head:r,prefix:i,scalar:s,point:c,pointBytes:l}}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=Wc(...n);return C(o(f(s,Gc("context",e),!!i)))}const R=Tl;A._setWindowSize(8);const x={getExtendedPublicKey:T,randomPrivateKey:()=>s(n.BYTES),precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};return{CURVE:t,getPublicKey:function(e){return T(e).pointBytes},sign:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=Gc("message",e),i&&(e=i(e));const{prefix:o,scalar:s,pointBytes:c}=T(t),l=k(r.context,o,e),u=A.multiply(l).toRawBytes(),h=I(l+k(r.context,u,c,e)*s);return v(h),Gc("result",Wc(u,qc(h,n.BYTES)),2*a)},verify:function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R;const{context:s,zip215:a}=o,c=n.BYTES;e=Gc("signature",e,2*c),t=Gc("message",t),i&&(t=i(t));const l=Vc(e.slice(c,2*c));let u,h,d;try{u=E.fromHex(r,a),h=E.fromHex(e.slice(0,c),a),d=A.multiplyUnsafe(l)}catch(p){return!1}if(!a&&u.isSmallOrder())return!1;const f=k(s,h.toRawBytes(),u.toRawBytes(),t);return h.add(u.multiplyUnsafe(f)).subtract(d).clearCofactor().equals(E.ZERO)},ExtendedPoint:E,utils:x}}const Rl=BigInt(0),xl=BigInt(1);function Pl(e){const t=(el(n=e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...n}));var n;const{P:r}=t,i=e=>cl(e,r),o=t.montgomeryBits,s=Math.ceil(o/8),a=t.nByteLength,c=t.adjustScalarBytes||(e=>e),l=t.powPminus2||(e=>ll(e,r-BigInt(2),r));function u(e,t,n){const r=i(e*(t-n));return[t=i(t-r),n=i(n+r)]}function h(e){if("bigint"===typeof e&&Rl<=e&&e<r)return e;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const d=(t.a-BigInt(2))/BigInt(4);function f(e){return qc(i(e),s)}function p(e,t){const n=function(e){const t=Gc("u coordinate",e,s);return a===s&&(t[a-1]&=127),Vc(t)}(t),r=function(e){const t=Gc("scalar",e);if(t.length!==s&&t.length!==a)throw new Error("Expected ".concat(s," or ").concat(a," bytes, got ").concat(t.length));return Vc(c(t))}(e),p=function(e,t){const n=h(e),r=h(t),s=n;let a,c=xl,f=Rl,p=n,g=xl,y=Rl;for(let l=BigInt(o-1);l>=Rl;l--){const e=r>>l&xl;y^=e,a=u(y,c,p),c=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1],y=e;const t=c+f,n=i(t*t),o=c-f,h=i(o*o),m=n-h,v=p+g,b=i((p-g)*t),w=i(v*o),E=b+w,A=b-w;p=i(E*E),g=i(s*i(A*A)),c=i(n*h),f=i(m*(n+i(d*m)))}a=u(y,c,p),c=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1];const m=l(f);return i(c*m)}(n,r);if(p===Rl)throw new Error("Invalid private or public key received");return f(p)}const g=f(t.Gu);function y(e){return p(e,g)}return{scalarMult:p,scalarMultBase:y,getSharedSecret:(e,t)=>p(e,t),getPublicKey:e=>y(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:g}}const Dl=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ol=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Nl=(BigInt(0),BigInt(1)),Bl=BigInt(2),Ll=BigInt(5),Ml=BigInt(10),Ul=BigInt(20),Fl=BigInt(40),Kl=BigInt(80);function jl(e){const t=Dl,n=e*e%t*e%t,r=ul(n,Bl,t)*n%t,i=ul(r,Nl,t)*e%t,o=ul(i,Ll,t)*i%t,s=ul(o,Ml,t)*o%t,a=ul(s,Ul,t)*s%t,c=ul(a,Fl,t)*a%t,l=ul(c,Kl,t)*c%t,u=ul(l,Kl,t)*c%t,h=ul(u,Ml,t)*o%t;return{pow_p_5_8:ul(h,Bl,t)*e%t,b2:n}}function Zl(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function zl(e,t){const n=Dl,r=cl(t*t*t,n),i=cl(r*r*t,n);let o=cl(e*r*jl(e*i).pow_p_5_8,n);const s=cl(t*o*o,n),a=o,c=cl(o*Ol,n),l=s===e,u=s===cl(-e,n),h=s===cl(-e*Ol,n);return l&&(o=a),(u||h)&&(o=c),fl(o,n)&&(o=cl(-o,n)),{isValid:l||u,value:o}}const Vl=yl(Dl,void 0,!0),Hl={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Vl,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Bc,randomBytes:_c,adjustScalarBytes:Zl,uvRatio:zl},ql=kl(Hl);function Gl(e,t,n){if(t.length>255)throw new Error("Context is too big");return Ec(bc("SigEd25519 no Ed25519 collisions"),new Uint8Array([n?1:0,t.length]),t,e)}const Wl=(()=>Pl({P:Dl,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=Dl,{pow_p_5_8:n,b2:r}=jl(e);return cl(ul(n,BigInt(3),t)*r,t)},adjustScalarBytes:Zl,randomBytes:_c}))();const Ql=(Vl.ORDER+BigInt(3))/BigInt(8);Vl.pow(Bl,Ql),Vl.sqrt(Vl.neg(Vl.ONE)),Vl.ORDER,BigInt(5),BigInt(8),BigInt(486662);!function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);e.isOdd(n)&&e.neg(n)}(Vl,Vl.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class Yl extends Ac{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,dc(e);const n=wc(t);if(this.iHash=e.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return fc(this),this.iHash.update(e),this}digestInto(e){fc(this),hc(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Jl=(e,t,n)=>new Yl(e,t).update(n).digest();function Xl(e,t,n){return dc(e),void 0===n&&(n=new Uint8Array(e.outputLen)),Jl(e,wc(n),wc(t))}Jl.create=(e,t)=>new Yl(e,t);const $l=new Uint8Array([0]),eu=new Uint8Array;function tu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;if(dc(e),uc(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=eu);const o=new Uint8Array(i*e.outputLen),s=Jl.create(e,t),a=s._cloneInto(),c=new Uint8Array(s.outputLen);for(let l=0;l<i;l++)$l[0]=l+1,a.update(0===l?eu:c).update(n).update($l).digestInto(c),o.set(c,e.outputLen*l),s._cloneInto(a);return s.destroy(),a.destroy(),c.fill(0),$l.fill(0),o.slice(0,r)}const nu=(e,t,n)=>e&t^e&n^t&n,ru=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),iu=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ou=new Uint32Array(64);class su extends Ic{constructor(){super(64,32,8,!1),this.A=0|iu[0],this.B=0|iu[1],this.C=0|iu[2],this.D=0|iu[3],this.E=0|iu[4],this.F=0|iu[5],this.G=0|iu[6],this.H=0|iu[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let h=0;h<16;h++,t+=4)ou[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const e=ou[h-15],t=ou[h-2],n=vc(e,7)^vc(e,18)^e>>>3,r=vc(t,17)^vc(t,19)^t>>>10;ou[h]=r+ou[h-7]+n+ou[h-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:l}=this;for(let h=0;h<64;h++){const e=l+(vc(s,6)^vc(s,11)^vc(s,25))+((u=s)&a^~u&c)+ru[h]+ou[h]|0,t=(vc(n,2)^vc(n,13)^vc(n,22))+nu(n,r,i)|0;l=c,c=a,a=s,s=o+e|0,o=i,i=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,o,s,a,c,l)}roundClean(){ou.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const au=Sc((()=>new su)),cu={hashSHA256:e=>au(e.subarray()),getHKDF(e,t){const n=Xl(au,t,e),r=tu(au,n,void 0,96);return[r.subarray(0,32),r.subarray(32,64),r.subarray(64,96)]},generateX25519KeyPair(){const e=Wl.utils.randomPrivateKey();return{publicKey:Wl.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:Wl.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>Wl.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,n,r)=>lc(r,t,n).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,n,r,i)=>lc(r,t,n).decrypt(e.subarray(),i)},lu=e=>{const t=(0,Us.E)(2);return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};lu.bytes=2;const uu=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};uu.bytes=2;class hu extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),(0,Yo.Z)(this,"code",void 0),this.code=hu.code}}(0,Yo.Z)(hu,"code","ERR_UNEXPECTED_PEER");class du extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),(0,Yo.Z)(this,"code",void 0),this.code=du.code}}(0,Yo.Z)(du,"code","ERR_INVALID_CRYPTO_EXCHANGE");n(85049),n(29835);var fu=n(7619),pu=n(60392),gu=n.n(pu),yu=n(80540),mu=n(39984),vu=n(46847),bu=n(56324),wu=n(63877),Eu=n.n(wu),Au=(n(3055),n(18601));function Su(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Au.B)(n,"base64url")}function _u(e){const t=function(e,t){let n=(0,yu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(gu().jsbn.BigInteger)((0,Au.B)(t,"base16"),16)}function Iu(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}const Cu=32,Tu=64,ku=32;function Ru(e,t){const n=new Uint8Array(Tu);for(let r=0;r<ku;r++)n[r]=e[r],n[ku+r]=t[r];return n}var xu=n(98117);const Pu={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},Du={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function Ou(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=Pu.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",Du,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",Du,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",Du,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return xu.base64.encode(r)}var Nu,Bu,Lu,Mu;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Nu||(Nu={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Bu||(Bu={})),function(e){e.codec=()=>bs(Bu)}(Nu||(Nu={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Nu.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Nu.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Lu||(Lu={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Nu.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Nu.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Mu||(Mu={}));class Uu{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=Vu(e,Cu)}verify(e,t){return function(e,t,n){return ql.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Lu.encode({Type:Nu.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=bu.sha256.digest(this.bytes);return Iu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class Fu{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=Vu(e,Tu),this._publicKey=Vu(t,Cu)}sign(e){return function(e,t){const n=e.subarray(0,ku);return ql.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new Uu(this._publicKey)}marshal(){return this._key}get bytes(){return Mu.encode({Type:Nu.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=bu.sha256.digest(this.bytes);let t;return Iu(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=vu.identity.digest(this.public.bytes);return mu.base58btc.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Ou(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Ku(e){if(e.length>Tu){const t=(e=Vu(e,Tu+Cu)).subarray(0,Tu),n=e.subarray(Tu,e.length);return new Fu(t,n)}const t=(e=Vu(e,Tu)).subarray(0,Tu),n=e.subarray(Cu);return new Fu(t,n)}function ju(e){return e=Vu(e,Cu),new Uu(e)}async function Zu(){const{privateKey:e,publicKey:t}=function(){const e=ql.utils.randomPrivateKey(),t=ql.getPublicKey(e);return{privateKey:Ru(e,t),publicKey:t}}();return new Fu(e,t)}async function zu(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==ku)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=ql.getPublicKey(t);return{privateKey:Ru(t,n),publicKey:n}}(e);return new Fu(t,n)}function Vu(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new fu.sv("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}const Hu={"P-256":256,"P-384":384,"P-521":521};Object.keys(Hu).join(" / ");n(34770);n(25493);function qu(e,t){return t.map((t=>_u(e[t])))}async function Gu(e){const t=[await Pu.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Qu(e)],n=await Wu({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function Wu(e){if(null==e.privateKey||null==e.publicKey)throw new fu.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Pu.get().subtle.exportKey("jwk",e.privateKey),Pu.get().subtle.exportKey("jwk",e.publicKey)])}async function Qu(e){return Pu.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Yu(e,t,n,r){const i=t?function(e){return gu().pki.setRsaPublicKey(...qu(e,["n","e"]))}(e):function(e){return gu().pki.setRsaPrivateKey(...qu(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Au.B)(n instanceof Uint8Array?n:n.subarray(),"ascii"),i);return(0,yu.m)(o,"ascii")}function Ju(e){if("RSA"!==e.kty)throw new fu.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new fu.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,yu.m)(e.n,"base64url").length}const Xu=8192;class $u{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await Pu.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Pu.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new fu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.publicKeyToAsn1({n:_u(e.n),e:_u(e.e)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Lu.encode({Type:Nu.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Yu(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=bu.sha256.digest(this.bytes);return Iu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class eh{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new fu.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return _c(e)}(16)}sign(e){return async function(e,t){const n=await Pu.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Pu.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new fu.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new $u(this._publicKey)}decrypt(e){return Yu(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new fu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.privateKeyToAsn1({n:_u(e.n),e:_u(e.e),d:_u(e.d),p:_u(e.p),q:_u(e.q),dP:_u(e.dp),dQ:_u(e.dq),qInv:_u(e.qi)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Mu.encode({Type:Nu.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=bu.sha256.digest(this.bytes);return Iu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(gu().util.ByteBuffer)(this.marshal()),n=gu().asn1.fromDer(t),r=gu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return gu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return Ou(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function th(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Su(n.n),e:Su(n.e),d:Su(n.d),p:Su(n.p),q:Su(n.q),dp:Su(n.dP),dq:Su(n.dQ),qi:Su(n.qInv),alg:"RS256"}}(e);if(Ju(t)>Xu)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await Gu(t);return new eh(n.privateKey,n.publicKey)}function nh(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Su(n.n),e:Su(n.e)}}(e);if(Ju(t)>Xu)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new $u(t)}async function rh(e){if(Ju(e)>Xu)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Gu(e);return new eh(t.privateKey,t.publicKey)}async function ih(e){if(e>Xu)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Pu.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await Wu(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new eh(t.privateKey,t.publicKey)}const{bytesToNumberBE:oh,hexToBytes:sh}=r,ah={Err:class extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}},_parseInt(e){const{Err:t}=ah;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:oh(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=ah,n="string"===typeof e?sh(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=ah._parseInt(n.subarray(2)),{d:s,l:a}=ah._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?"0".concat(t):t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return"30".concat(n(s+o+4),"02").concat(c).concat(i,"02").concat(a).concat(r)}},ch=BigInt(0),lh=BigInt(1),uh=(BigInt(2),BigInt(3));BigInt(4);function hh(e){const t=function(e){const t=Al(e);el(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof n||"bigint"!==typeof n.beta||"function"!==typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return Wc(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"===typeof e&&ch<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!==typeof e){if(e instanceof Uint8Array&&(e=Kc(e)),"string"!==typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"===typeof e?e:zc(Gc("private key",e,r))}catch(c){throw new Error("private key must be ".concat(r," bytes, hex or bigint, not ").concat(typeof e))}return i&&(s=cl(s,o)),a(s),s}const l=new Map;function u(e){if(!(e instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof h)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?h.ZERO:new h(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}static fromHex(e){const t=h.fromAffine(i(Gc("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),l=n.eql(n.mul(r,a),n.mul(s,i));return c&&l}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,uh),{px:o,py:s,pz:a}=this;let c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),u=n.mul(o,a),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,p),l=n.add(c,l),c=n.sub(f,l),l=n.add(f,l),l=n.mul(c,l),c=n.mul(g,c),u=n.mul(i,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),l=n.add(l,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),u=n.mul(p,f),u=n.add(u,u),u=n.add(u,u),new h(c,l,u)}add(e){u(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let l=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,uh);let y=n.mul(r,s),m=n.mul(i,a),v=n.mul(o,c),b=n.add(r,i),w=n.add(s,a);b=n.mul(b,w),w=n.add(y,m),b=n.sub(b,w),w=n.add(r,o);let E=n.add(s,c);return w=n.mul(w,E),E=n.add(y,v),w=n.sub(w,E),E=n.add(i,o),l=n.add(a,c),E=n.mul(E,l),l=n.add(m,v),E=n.sub(E,l),f=n.mul(p,w),l=n.mul(g,v),f=n.add(l,f),l=n.sub(m,f),f=n.add(m,f),d=n.mul(l,f),m=n.add(y,y),m=n.add(m,y),v=n.mul(p,v),w=n.mul(g,w),m=n.add(m,v),v=n.sub(y,v),v=n.mul(p,v),w=n.add(w,v),y=n.mul(m,w),d=n.add(d,y),y=n.mul(E,w),l=n.mul(b,l),l=n.sub(l,y),y=n.mul(b,m),f=n.mul(E,f),f=n.add(f,y),new h(l,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return f.wNAFCached(this,l,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}))}multiplyUnsafe(e){const r=h.ZERO;if(e===ch)return r;if(a(e),e===lh)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:l}=i.splitScalar(e),u=r,d=r,p=this;for(;s>ch||l>ch;)s&lh&&(u=u.add(p)),l&lh&&(d=d.add(p)),p=p.double(),s>>=lh,l>>=lh;return o&&(u=u.negate()),c&&(d=d.negate()),d=new h(n.mul(d.px,i.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:l,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);l=f.constTimeNegate(e,l),d=f.constTimeNegate(a,d),d=new h(n.mul(d.px,s.beta),d.py,d.pz),r=l.add(d),i=u.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return h.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=h.BASE,i=(e,t)=>t!==ch&&t!==lh&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===lh)return!0;if(n)return n(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===lh?this:n?n(h,this):this.multiplyUnsafe(t.h)}toRawBytes(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(h,this,e)}toHex(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Kc(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=El(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function dh(e){const t=function(e){const t=Al(e);return el(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return cl(e,r)}function a(e){return hl(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=hh({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=Wc;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error("Point of length ".concat(t," was invalid. Expected ").concat(i," compressed bytes or ").concat(o," uncompressed bytes"))}{const e=zc(s);if(!(ch<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let i=n.sqrt(t);return 1===(1&r)!==((i&lh)===lh)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>Kc(Hc(e,t.nByteLength));function f(e){return e>r>>lh}const p=(e,t,n)=>zc(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=Gc("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=ah.toSig(Gc("DER",e));return new g(t,n)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:i,recovery:o}=this,l=b(Gc("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const u=2===o||3===o?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0===(1&o)?"02":"03",f=c.fromHex(h+d(u)),p=a(u),g=s(-l*p),y=s(i*p),m=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Zc(this.toDERHex())}toDERHex(){return ah.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Zc(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return l(e),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const e=vl(t.n);return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.length,i=ml(t),o=vl(t);if(r<16||r<o||r>1024)throw new Error("expected ".concat(o,"-1024 bytes of input, got ").concat(r));const s=cl(n?zc(e):Vc(e),t-nl)+nl;return n?qc(s,i):Hc(s,i)}(t.randomBytes(e),t.n)},precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function m(e){const t=e instanceof Uint8Array,n="string"===typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const v=t.bits2int||function(e){const n=zc(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(v(e))},w=Qc(t.nBitLength);function E(e){if("bigint"!==typeof e)throw new Error("bigint expected");if(!(ch<=e&&e<w))throw new Error("bigint expected < 2^".concat(t.nBitLength));return Hc(e,t.nByteLength)}function A(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=Gc("msgHash",e),p&&(e=Gc("prehashed msgHash",o(e)));const m=b(e),w=l(r),A=[E(w),E(m)];if(null!=y){const e=!0===y?u(n.BYTES):y;A.push(Gc("extraEntropy",e))}const _=Wc(...A),I=m;return{seed:_,k2sig:function(e){const t=v(e);if(!h(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===ch)return;const o=s(n*s(I+i*w));if(o===ch)return;let l=(r.x===i?0:2)|Number(r.y&lh),u=o;return d&&f(o)&&(u=function(e){return f(e)?s(-e):e}(o),l^=1),new g(i,u,l)}}}const S={lowS:t.lowS,prehash:!1},_={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;const{seed:i,k2sig:o}=A(e,n,r),s=t;return Xc(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r){var i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_;const l=e;if(n=Gc("msgHash",n),r=Gc("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:h}=o;let d,f;try{if("string"===typeof l||l instanceof Uint8Array)try{d=g.fromDER(l)}catch(S){if(!(S instanceof ah.Err))throw S;d=g.fromCompact(l)}else{if("object"!==typeof l||"bigint"!==typeof l.r||"bigint"!==typeof l.s)throw new Error("PARSE");{const{r:e,s:t}=l;d=new g(e,t)}}f=c.fromHex(r)}catch(I){if("PARSE"===I.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;h&&(n=t.hash(n));const{r:p,s:y}=d,m=b(n),v=a(y),w=s(m*v),E=s(p*v),A=null===(i=c.BASE.multiplyAndAddUnsafe(f,w,E))||void 0===i?void 0:i.toAffine();return!!A&&s(A.x)===p},ProjectivePoint:c,Signature:g,utils:y}}function fh(e){return{hash:e,hmac:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Jl(e,t,Ec(...r))},randomBytes:_c}}const ph=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),gh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),yh=BigInt(1),mh=BigInt(2),vh=(e,t)=>(e+t/mh)/t;function bh(e){const t=ph,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=ul(u,n,t)*u%t,d=ul(h,n,t)*u%t,f=ul(d,mh,t)*l%t,p=ul(f,i,t)*f%t,g=ul(p,o,t)*p%t,y=ul(g,a,t)*g%t,m=ul(y,c,t)*y%t,v=ul(m,a,t)*g%t,b=ul(v,n,t)*u%t,w=ul(b,s,t)*p%t,E=ul(w,r,t)*l%t,A=ul(E,mh,t);if(!wh.eql(wh.sqr(A),e))throw new Error("Cannot find square root");return A}const wh=yl(ph,void 0,void 0,{sqrt:bh}),Eh=function(e,t){const n=t=>dh({...e,...fh(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:wh,n:gh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=gh,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-yh*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=vh(o*e,t),c=vh(-r*e,t);let l=cl(e-a*n-c*i,t),u=cl(-a*r-c*o,t);const h=l>s,d=u>s;if(h&&(l=t-l),d&&(u=t-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},au);BigInt(0);Eh.ProjectivePoint;function Ah(e){try{Eh.ProjectivePoint.fromHex(e)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PUBLIC_KEY")}}class Sh{constructor(e){(0,Yo.Z)(this,"_key",void 0),Ah(e),this._key=e}verify(e,t){return function(e,t,n){const r=bu.sha256.digest(n instanceof Uint8Array?n:n.subarray());if(Iu(r))return r.then((n=>{let{digest:r}=n;return Eh.verify(t,r,e)})).catch((e=>{throw new fu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Eh.verify(t,r.digest,e)}catch(i){throw new fu.sv(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Eh.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Lu.encode({Type:Nu.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=bu.sha256.digest(this.bytes);let t;return Iu(e)?({bytes:t}=await e):t=e.bytes,t}}class _h{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Eh.getPublicKey(e,!0)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Eh.getPublicKey(e,!0)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Ah(this._publicKey)}sign(e){return function(e,t){const n=bu.sha256.digest(t instanceof Uint8Array?t:t.subarray());if(Iu(n))return n.then((t=>{let{digest:n}=t;return Eh.sign(n,e).toDERRawBytes()})).catch((e=>{throw new fu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Eh.sign(n.digest,e).toDERRawBytes()}catch(r){throw new fu.sv(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Sh(this._publicKey)}marshal(){return this._key}get bytes(){return Mu.encode({Type:Nu.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=bu.sha256.digest(this.bytes);return Iu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Ou(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Ih(e){return new _h(e)}function Ch(e){return new Sh(e)}async function Th(){const e=Eh.utils.randomPrivateKey();return new _h(e)}const kh={rsa:o,ed25519:i,secp256k1:s};function Rh(e){const t=Object.keys(kh).join(" / ");return new fu.sv("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function xh(e){var t,n;const r=Lu.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Nu.RSA:return kh.rsa.unmarshalRsaPublicKey(i);case Nu.Ed25519:return kh.ed25519.unmarshalEd25519PublicKey(i);case Nu.Secp256k1:return kh.secp256k1.unmarshalSecp256k1PublicKey(i);default:throw Rh(null!==(n=r.Type)&&void 0!==n?n:"unknown")}}async function Ph(e){var t,n;const r=Mu.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Nu.RSA:return kh.rsa.unmarshalRsaPrivateKey(i);case Nu.Ed25519:return kh.ed25519.unmarshalEd25519PrivateKey(i);case Nu.Secp256k1:return kh.secp256k1.unmarshalSecp256k1PrivateKey(i);default:throw Rh(null!==(n=r.Type)&&void 0!==n?n:"RSA")}}var Dh=n(3734);const Oh=Symbol.for("nodejs.util.inspect.custom"),Nh=Object.values(Dh.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Dh.gh.identity.decoder),Bh=114,Lh=36,Mh=37;class Uh{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,fu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=mu.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Gr.CID.createV1(Bh,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return Zh(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Oh](){return"PeerId(".concat(this.toString(),")")}}class Fh extends Uh{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Kh extends Uh{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class jh extends Uh{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function Zh(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:Nh,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=ni.Jx(mu.base58btc.decode("z".concat(e)));return e.startsWith("12D")?new Kh({multihash:t}):e.startsWith("16U")?new jh({multihash:t}):new Fh({multihash:t})}return function(e){try{const t=ni.Jx(e);if(t.code===vu.identity.code){if(t.digest.length===Lh)return new Kh({multihash:t});if(t.digest.length===Mh)return new jh({multihash:t})}if(t.code===bu.sha256.code)return new Fh({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Bh)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===bu.sha256.code)return new Fh({multihash:e.multihash});if(t.code===vu.identity.code){if(t.digest.length===Lh)return new Kh({multihash:e.multihash});if(t.digest.length===Mh)return new jh({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Gr.CID.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(Nh.decode(e))}async function zh(e,t){return e.length===Lh?new Kh({multihash:ni.Ue(vu.identity.code,e),privateKey:t}):e.length===Mh?new jh({multihash:ni.Ue(vu.identity.code,e),privateKey:t}):new Fh({multihash:await bu.sha256.digest(e),publicKey:e,privateKey:t})}var Vh,Hh;async function qh(e,t,n){const r=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");return(await Ph(e.privateKey)).sign(t)}(e,Qh(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,n){return Hh.encode({identityKey:e,identitySig:t,extensions:null!==n&&void 0!==n?n:{webtransportCerthashes:[]}}).subarray()}(e.publicKey,r,n)}async function Gh(e){return zh(e.identityKey)}function Wh(e){return Hh.decode(e)}function Qh(e){const t=(0,yu.m)("noise-libp2p-static-key:");return e instanceof Uint8Array?(0,Ls.z)([t,e],t.length+e.length):(e.prepend(t),e)}async function Yh(e,t,n){const r=await zh(t.identityKey);if(!r.equals(n))throw new Error("Payload identity key ".concat(r.toString()," does not match expected remote peer ").concat(n.toString()));const i=Qh(e);if(null==r.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const o=xh(r.publicKey);if(!await o.verify(i,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return r}function Jh(e){return!!(e instanceof Uint8Array||js(e))&&32===e.byteLength}!function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={webtransportCerthashes:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Vh||(Vh={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),Vh.codec().encode(e.extensions,t)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identityKey:(0,Us.u)(0),identitySig:(0,Us.u)(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=Vh.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Hh||(Hh={}));var Xh=n(27929);class $h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,Yo.Z)(this,"n",void 0),(0,Yo.Z)(this,"bytes",void 0),(0,Yo.Z)(this,"view",void 0),this.n=e,this.bytes=(0,Us.u)(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class ed{constructor(e,t){(0,Yo.Z)(this,"crypto",void 0),(0,Yo.Z)(this,"log",void 0),this.log=e.logger.forComponent("libp2p:noise:abstract-handshake"),this.crypto=t}encryptWithAd(e,t,n){const r=this.encrypt(e.k,e.n,t,n);return e.n.increment(),r}decryptWithAd(e,t,n,r){const{plaintext:i,valid:o}=this.decrypt(e.k,e.n,t,n,r);return o&&e.n.increment(),{plaintext:i,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return(0,Us.u)(32)}isEmptyKey(e){const t=this.createEmptyKey();return(0,Ms.f)(t,e)}encrypt(e,t,n,r){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return n=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,n),n}decrypt(e,t,n,r,i){t.assertValue();const o=this.crypto.chaCha20Poly1305Decrypt(r,t.getBytes(),n,e,i);return o?{plaintext:o,valid:!0}:{plaintext:(0,Us.u)(0),valid:!1}}decryptAndHash(e,t){let n,r=!0;return this.hasKey(e.cs)?({plaintext:n,valid:r}=this.decryptWithAd(e.cs,e.h,t)):n=t,this.mixHash(e,t),{plaintext:n,valid:r}}dh(e,t){try{const n=this.crypto.generateX25519SharedKey(e,t);return 32===n.length?n:n.subarray(0,32)}catch(n){const e=n;return this.log.error("error deriving shared key",e),(0,Us.u)(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(new Zs(e,t))}mixKey(e,t){const[n,r]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(r),e.ck=n}initializeKey(e){return{k:e,n:new $h}}initializeSymmetric(e){const t=(0,Xh.mL)(e,"utf-8"),n=this.hashProtocolName(t),r=n,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:r,h:n}}hashProtocolName(e){if(e.length<=32){const t=(0,Us.u)(32);return t.set(e),t}return this.getHash(e,(0,Us.u)(0))}split(e){const[t,n]=this.crypto.getHKDF(e.ck,(0,Us.u)(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(n)}}writeMessageRegular(e,t){const n=this.encryptWithAd(e,(0,Us.u)(0),t);return{ne:this.createEmptyKey(),ns:(0,Us.u)(0),ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,(0,Us.u)(0),t.ciphertext)}}class td extends ed{initializeInitiator(e,t,n,r){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:n,psk:r,re:(0,Us.u)(32)}}initializeResponder(e,t,n,r){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:n,psk:r,re:(0,Us.u)(32)}}writeMessageA(e,t,n){const r=(0,Us.u)(0);e.e=void 0!==n?n:this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i);return{ne:i,ns:r,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const r=e.s.publicKey,i=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:n,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const n=e.s.publicKey,r=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),o={ne:this.createEmptyKey(),ns:r,ciphertext:i},{cs1:s,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:o,cs1:s,cs2:a}}readMessageA(e,t){return Jh(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(Jh(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);r&&Jh(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:r&&o}}readMessageC(e,t){const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);if(r&&Jh(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:s,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:r&&o,cs1:s,cs2:a}}initSession(e,t,n){const r=this.createEmptyKey(),i=(0,Us.u)(32);let o;return o=e?this.initializeInitiator(t,n,i,r):this.initializeResponder(t,n,i,r),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let r;if(0===e.mc)r=this.writeMessageA(e.hs,t,n);else if(1===e.mc)r=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:n,messageBuffer:i,cs1:o,cs2:s}=this.writeMessageC(e.hs,t);r=i,e.h=n,e.cs1=o,e.cs2=s}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}recvMessage(e,t){let n=(0,Us.u)(0),r=!1;if(0===e.mc)({plaintext:n,valid:r}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:n,valid:r}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:o,valid:s,cs1:a,cs2:c}=this.readMessageC(e.hs,t);n=o,r=s,e.h=i,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:n,valid:r}}}function nd(e,t){t.enabled&&Ca&&(e?(t("LOCAL_PUBLIC_EPHEMERAL_KEY ".concat((0,Au.B)(e.publicKey,"hex"))),t("LOCAL_PRIVATE_EPHEMERAL_KEY ".concat((0,Au.B)(e.privateKey,"hex")))):t("Missing local ephemeral keys."))}function rd(e,t){t.enabled&&Ca&&t("REMOTE_EPHEMERAL_PUBLIC_KEY ".concat((0,Au.B)(e.subarray(),"hex")))}class id{constructor(e,t,n,r,i,o,s,a,c){(0,Yo.Z)(this,"isInitiator",void 0),(0,Yo.Z)(this,"session",void 0),(0,Yo.Z)(this,"remotePeer",void 0),(0,Yo.Z)(this,"remoteExtensions",{webtransportCerthashes:[]}),(0,Yo.Z)(this,"payload",void 0),(0,Yo.Z)(this,"connection",void 0),(0,Yo.Z)(this,"xx",void 0),(0,Yo.Z)(this,"staticKeypair",void 0),(0,Yo.Z)(this,"prologue",void 0),(0,Yo.Z)(this,"log",void 0),this.log=e.logger.forComponent("libp2p:noise:xxhandshake"),this.isInitiator=t,this.payload=n,this.prologue=r,this.staticKeypair=o,this.connection=s,a&&(this.remotePeer=a),this.xx=null!==c&&void 0!==c?c:new td(e,i),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(function(e,t){t.enabled&&Ca&&(t("LOCAL_STATIC_PUBLIC_KEY ".concat((0,Au.B)(e.publicKey,"hex"))),t("LOCAL_STATIC_PRIVATE_KEY ".concat((0,Au.B)(e.privateKey,"hex"))))}(this.session.hs.s,this.log),this.isInitiator){this.log.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,(0,Us.u)(0));await this.connection.write(function(e){return new Zs(e.ne,e.ciphertext)}(e)),this.log.trace("Stage 0 - Initiator finished sending first message."),nd(this.session.hs.e,this.log)}else{this.log.trace("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:(0,Us.u)(0)}}((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new du("xx handshake stage 0 validation fail");this.log.trace("Stage 0 - Responder received first message."),rd(this.session.hs.re,this.log)}}async exchange(){if(this.isInitiator){this.log.trace("Stage 1 - Initiator waiting to receive first message from responder...");const t=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.read()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new du("xx handshake stage 1 validation fail");this.log.trace("Stage 1 - Initiator received the message."),rd(this.session.hs.re,this.log),function(e,t){t.enabled&&Ca&&t("REMOTE_STATIC_PUBLIC_KEY ".concat((0,Au.B)(e.subarray(),"hex")))}(this.session.hs.rs,this.log),this.log.trace("Initiator going to check remote's signature...");try{const e=Wh(n);this.remotePeer=this.remotePeer||await Gh(e),await Yh(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new hu("Error occurred while verifying signed payload: ".concat(e.message))}this.log.trace("All good with the signature!")}else{this.log.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(function(e){return new Zs(e.ne,e.ns,e.ciphertext)}(e)),this.log.trace("Stage 1 - Responder sent the second handshake message with signed payload."),nd(this.session.hs.e,this.log)}}async finish(){if(this.isInitiator){this.log.trace("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(function(e){return new Zs(e.ns,e.ciphertext)}(e)),this.log.trace("Stage 2 - Initiator sent message with signed payload.")}else{this.log.trace("Stage 2 - Responder waiting for third handshake message...");const t=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:(0,Us.u)(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.read()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new du("xx handshake stage 2 validation fail");this.log.trace("Stage 2 - Responder received the message, finished handshake.");try{const e=Wh(n);this.remotePeer=this.remotePeer||await Gh(e),await Yh(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new hu("Error occurred while verifying signed payload: ".concat(e.message))}}!function(e,t){t.enabled&&Ca&&(e.cs1&&e.cs2?(t("CIPHER_STATE_1 ".concat(e.cs1.n.getUint64()," ").concat((0,Au.B)(e.cs1.k,"hex"))),t("CIPHER_STATE_2 ".concat(e.cs2.n.getUint64()," ").concat((0,Au.B)(e.cs2.k,"hex")))):t("Missing cipher state."))}(this.session,this.log)}encrypt(e,t){const n=this.getCS(t);return this.xx.encryptWithAd(n,(0,Us.u)(0),e)}decrypt(e,t,n){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,(0,Us.u)(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.cs1||!e.cs2)throw new du("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class od{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Yo.Z)(this,"protocol","/noise"),(0,Yo.Z)(this,"crypto",void 0),(0,Yo.Z)(this,"prologue",void 0),(0,Yo.Z)(this,"staticKeys",void 0),(0,Yo.Z)(this,"extensions",void 0),(0,Yo.Z)(this,"metrics",void 0),(0,Yo.Z)(this,"components",void 0);const{staticNoiseKey:n,extensions:r,crypto:i,prologueBytes:o}=t,{metrics:s}=e;this.components=e,this.crypto=null!==i&&void 0!==i?i:cu,this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKeys=n?this.crypto.generateX25519KeyPairFromSeed(n):this.crypto.generateX25519KeyPair(),this.prologue=null!==o&&void 0!==o?o:(0,Us.u)(0)}async secureOutbound(e,t,n){const r=la(t,{lengthEncoder:lu,lengthDecoder:uu,maxDataLength:Ia}),i=await this.performHandshake({connection:r,isInitiator:!0,localPeer:e,remotePeer:n}),o=await this.createSecureConnection(r,i);return t.source=o.source,t.sink=o.sink,{conn:t,remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,n){const r=la(t,{lengthEncoder:lu,lengthDecoder:uu,maxDataLength:Ia}),i=await this.performHandshake({connection:r,isInitiator:!1,localPeer:e,remotePeer:n}),o=await this.createSecureConnection(r,i);return t.source=o.source,t.sink=o.sink,{conn:t,remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await qh(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:n,remotePeer:r,connection:i}=e,o=new id(this.components,n,t,this.prologue,this.crypto,this.staticKeys,i,r);try{var s;await o.propose(),await o.exchange(),await o.finish(),null===(s=this.metrics)||void 0===s||s.xxHandshakeSuccesses.increment()}catch(c){var a;if(null===(a=this.metrics)||void 0===a||a.xxHandshakeErrors.increment(),c instanceof Error)throw c.message="Error occurred during XX handshake: ".concat(c.message),c}return o}async createSecureConnection(e,t){const[n,r]=function(){const e=ua(),t=ua();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await ma(n,function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=65519){let i,o=n+65519;o>r.length&&(o=r.length),i=r instanceof Uint8Array?e.encrypt(r.subarray(n,o),e.session):e.encrypt(r.sublist(n,o),e.session),null===t||void 0===t||t.encryptedPackets.increment(),yield new Zs(lu(i.byteLength),i)}}}(t,this.metrics),i,(e=>Gs(e,{lengthDecoder:uu})),function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=Ia){let i=n+Ia;if(i>r.length&&(i=r.length),i-16<n)throw new Error("Invalid chunk");const o=r.sublist(n,i),s=r.subarray(n,i-16),{plaintext:a,valid:c}=e.decrypt(o,e.session,s);if(!c)throw null===t||void 0===t||t.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");null===t||void 0===t||t.decryptedPackets.increment(),yield a}}}(t,this.metrics),n),r}}function sd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new od(t,e)}function ad(e){if(null!=e){if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"===typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}class cd{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class ld{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new cd(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new cd(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class ud extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function hd(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new ld,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new ld,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new ld,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new ud)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}var dd=n(9963);const fd="ERR_INVALID_FRAME",pd="ERR_UNREQUESTED_PING",gd="ERR_NOT_MATCHING_PING",yd="ERR_STREAM_ALREADY_EXISTS",md="ERR_DECODE_INVALID_VERSION",vd="ERR_BOTH_CLIENTS",bd="ERR_RECV_WINDOW_EXCEEDED",wd=new Set([fd,pd,gd,yd,md,vd,bd]),Ed="ERR_INVALID_CONFIG",Ad="ERR_MUXER_LOCAL_CLOSED",Sd="ERR_MUXER_REMOTE_CLOSED",_d=262144,Id={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:_d,maxStreamWindowSize:16777216,maxMessageSize:65536};var Cd,Td;!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(Cd||(Cd={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(Td||(Td={}));Object.values(Td).filter((e=>"string"!==typeof e));var kd;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(kd||(kd={}));const Rd=2**24;class xd{constructor(e){(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"frameInProgress",void 0),this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new Zs,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:n}=e;t===Cd.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,n)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new fu.sv("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new fu.sv("Invalid frame version",md);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*Rd+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*Rd+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function Pd(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}class Dd{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Od{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new Dd(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Dd(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class Nd extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function Bd(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new Od,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new Od,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new Od,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new Nd)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}function Ld(e,t){var n,r;const i=null===(n=(r=ad(e)).return)||void 0===n?void 0:n.call(r);var o;null!=(o=i)&&"function"===typeof o.then&&"function"===typeof o.catch&&"function"===typeof o.finally&&i.catch((e=>{t.error("could not cause iterator to return",e)}))}function Md(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}class Ud{constructor(e){var t,n;(0,Yo.Z)(this,"id",void 0),(0,Yo.Z)(this,"direction",void 0),(0,Yo.Z)(this,"timeline",void 0),(0,Yo.Z)(this,"protocol",void 0),(0,Yo.Z)(this,"metadata",void 0),(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"status",void 0),(0,Yo.Z)(this,"readStatus",void 0),(0,Yo.Z)(this,"writeStatus",void 0),(0,Yo.Z)(this,"log",void 0),(0,Yo.Z)(this,"sinkController",void 0),(0,Yo.Z)(this,"sinkEnd",void 0),(0,Yo.Z)(this,"closed",void 0),(0,Yo.Z)(this,"endErr",void 0),(0,Yo.Z)(this,"streamSource",void 0),(0,Yo.Z)(this,"onEnd",void 0),(0,Yo.Z)(this,"onCloseRead",void 0),(0,Yo.Z)(this,"onCloseWrite",void 0),(0,Yo.Z)(this,"onReset",void 0),(0,Yo.Z)(this,"onAbort",void 0),(0,Yo.Z)(this,"sendCloseWriteTimeout",void 0),this.sinkController=new AbortController,this.sinkEnd=Ws(),this.closed=Ws(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=null!==(t=e.metadata)&&void 0!==t?t:{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=null!==(n=e.sendCloseWriteTimeout)&&void 0!==n?n:5e3,this.onEnd=e.onEnd,this.onCloseRead=null===e||void 0===e?void 0:e.onCloseRead,this.onCloseWrite=null===e||void 0===e?void 0:e.onCloseWrite,this.onReset=null===e||void 0===e?void 0:e.onReset,this.onAbort=null===e||void 0===e?void 0:e.onAbort,this.source=this.streamSource=function(){return Bd((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new fu.sv('writable end state is "'.concat(this.writeStatus,'" not "ready"'),"ERR_SINK_INVALID_STATE");try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if("outbound"===this.direction){const e=this.sendNewStream(t);Md(e)&&await e}const n=()=>{Ld(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let n of e){n=n instanceof Uint8Array?new Zs(n):n;const e=this.sendData(n,t);Md(e)&&await e}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseRead)||void 0===t||t.call(this),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseWrite)||void 0===t||t.call(this),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await Promise.all([this.closeRead(e),this.closeWrite(e)]),await Ys(this.closed.promise,null===e||void 0===e?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully")}async closeRead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await Ys(this.sink([]),e.signal)),"writing"===this.writeStatus&&await new Promise(((t,n)=>{queueMicrotask((()=>{this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),Ys(this.sinkEnd.promise,e.signal).then(t,n)}))})),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var t;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");const n=this.sendReset();Md(n)&&n.catch((e=>{this.log.error("error sending reset message",e)})),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),null===(t=this.onAbort)||void 0===t||t.call(this,e)}reset(){var e;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const t=new fu.sv("stream reset","ERR_STREAM_RESET");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(t),null===(e=this.onReset)||void 0===e||e.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("stream destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}const Fd=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};function Kd(e){return null!=(null===e||void 0===e?void 0:e.then)}const jd=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e){const e=t(n);Kd(e)&&await e,yield n}}();const n=Fd(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof(null===o||void 0===o?void 0:o.then))return async function*(){yield r;for await(const e of n){const n=t(e);Kd(n)&&await n,yield e}}();const s=t;return function*(){yield r;for(const e of n)s(e),yield e}()};var Zd;!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(Zd||(Zd={}));class zd extends Ud{constructor(e){super({...e,onEnd:t=>{var n;this.state=Zd.Finished,null===(n=e.onEnd)||void 0===n||n.call(e,t)}}),(0,Yo.Z)(this,"name",void 0),(0,Yo.Z)(this,"state",void 0),(0,Yo.Z)(this,"config",void 0),(0,Yo.Z)(this,"_id",void 0),(0,Yo.Z)(this,"sendWindowCapacity",void 0),(0,Yo.Z)(this,"sendWindowCapacityUpdate",void 0),(0,Yo.Z)(this,"recvWindow",void 0),(0,Yo.Z)(this,"recvWindowCapacity",void 0),(0,Yo.Z)(this,"epochStart",void 0),(0,Yo.Z)(this,"getRTT",void 0),(0,Yo.Z)(this,"sendFrame",void 0),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=_d,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=jd(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity(t),"open"!==this.status)return;const n=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),r=this.getSendFlags();this.sendFrame({type:Cd.Data,flag:r,streamID:this._id,length:n},e.sublist(0,n)),this.sendWindowCapacity-=n,e.consume(n)}}async sendReset(){this.sendFrame({type:Cd.WindowUpdate,flag:Td.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|Td.FIN;this.sendFrame({type:Cd.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(){var e;let t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.sendWindowCapacity>0)return;const i=()=>{"open"===this.status?n(new fu.sv("stream aborted","ERR_STREAM_ABORT")):t()};null===(e=r.signal)||void 0===e||e.addEventListener("abort",i);try{await new Promise(((e,r)=>{this.sendWindowCapacityUpdate=()=>{e()},n=r,t=e}))}finally{var o;null===(o=r.signal)||void 0===o||o.removeEventListener("abort",i)}}handleWindowUpdate(e){var t;null===(t=this.log)||void 0===t||t.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const n=this.sendWindowCapacity;var r;(this.sendWindowCapacity+=e.length,0===n&&e.length>0)&&(null===(r=this.sendWindowCapacityUpdate)||void 0===r||r.call(this))}async handleData(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new fu.sv("receive window exceeded",bd,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&Td.ACK)===Td.ACK&&this.state===Zd.SYNSent&&(this.state=Zd.Established),(e&Td.FIN)===Td.FIN&&this.remoteCloseWrite(),(e&Td.RST)===Td.RST&&this.reset()}getSendFlags(){switch(this.state){case Zd.Init:return this.state=Zd.SYNSent,Td.SYN;case Zd.SYNReceived:return this.state=Zd.Established,Td.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(0===e&&n>-1&&t-this.epochStart<4*n&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const r=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:Cd.WindowUpdate,flag:e,streamID:this._id,length:r})}}const Vd="/yamux/1.0.0";class Hd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Yo.Z)(this,"protocol",Vd),(0,Yo.Z)(this,"_components",void 0),(0,Yo.Z)(this,"_init",void 0),this._components=e,this._init=t}createStreamMuxer(e){return new qd(this._components,{...this._init,...e})}}class qd{constructor(e,t){var n;(0,Yo.Z)(this,"protocol",Vd),(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"sink",void 0),(0,Yo.Z)(this,"config",void 0),(0,Yo.Z)(this,"log",void 0),(0,Yo.Z)(this,"logger",void 0),(0,Yo.Z)(this,"closeController",void 0),(0,Yo.Z)(this,"nextStreamID",void 0),(0,Yo.Z)(this,"_streams",void 0),(0,Yo.Z)(this,"nextPingID",void 0),(0,Yo.Z)(this,"activePing",void 0),(0,Yo.Z)(this,"rtt",void 0),(0,Yo.Z)(this,"client",void 0),(0,Yo.Z)(this,"localGoAway",void 0),(0,Yo.Z)(this,"remoteGoAway",void 0),(0,Yo.Z)(this,"numInboundStreams",void 0),(0,Yo.Z)(this,"numOutboundStreams",void 0),(0,Yo.Z)(this,"onIncomingStream",void 0),(0,Yo.Z)(this,"onStreamEnd",void 0),this.client="outbound"===t.direction,this.config={...Id,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),function(e){if(e.keepAliveInterval<=0)throw new dd.sv("keep-alive interval must be positive",Ed);if(e.maxInboundStreams<0)throw new dd.sv("max inbound streams must be larger or equal 0",Ed);if(e.maxOutboundStreams<0)throw new dd.sv("max outbound streams must be larger or equal 0",Ed);if(e.initialStreamWindowSize<_d)throw new dd.sv("InitialStreamWindowSize must be larger or equal 256 kB",Ed);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new dd.sv("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",Ed);if(e.maxStreamWindowSize>2**32-1)throw new dd.sv("MaxStreamWindowSize must be less than equal MAX_UINT32",Ed);if(e.maxMessageSize<1024)throw new dd.sv("MaxMessageSize must be greater than a kilobyte",Ed)}(this.config),this.closeController=new AbortController,(0,fu.Wp)(1/0,this.closeController.signal),this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=function(){return hd((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({onEnd:()=>{var e;null===(e=this.log)||void 0===e||e.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{var t;const n=()=>{const t=ad(e);if(null!=t.return){const e=t.return();null!=(n=e)&&"function"===typeof n.then&&e.catch((e=>{var t;null===(t=this.log)||void 0===t||t.call(this,"could not cause sink source to return",e)}))}var n};let r,i;try{const t=new xd(e);try{this.closeController.signal.addEventListener("abort",n);for await(const e of t.emitFrames())await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",n)}r=kd.NormalTermination}catch(a){const e=a.code;var o,s;if(wd.has(e))null===(o=this.log)||void 0===o||o.error("protocol error in sink",a),r=kd.ProtocolError;else null===(s=this.log)||void 0===s||s.error("internal error in sink",a),r=kd.InternalError;i=a}null===(t=this.log)||void 0===t||t.trace("muxer sink ended"),null!=i?this.abort(i,r):await this.close({reason:r})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,null===(n=this.log)||void 0===n||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("keepalive error: %s",e)})),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}get streams(){return Array.from(this._streams.values())}newStream(e){var t;if(void 0!==this.remoteGoAway)throw new fu.sv("muxer closed remotely",Sd);if(void 0!==this.localGoAway)throw new fu.sv("muxer closed locally",Ad);const n=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new fu.sv("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");null===(t=this.log)||void 0===t||t.trace("new outgoing stream id=%s",n);const r=this._newStream(n,e,Zd.Init,"outbound");return this._streams.set(n,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new fu.sv("muxer closed remotely",Sd);if(void 0!==this.localGoAway)throw new fu.sv("muxer closed locally",Ad);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,n)=>{const r=()=>{n(new fu.sv("muxer closed locally",Ad))};this.closeController.signal.addEventListener("abort",r,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",r),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.closeController.signal.aborted)return;const i=null!==(e=null===(t=r)||void 0===t?void 0:t.reason)&&void 0!==e?e:kd.NormalTermination;if(null===(n=this.log)||void 0===n||n.trace("muxer close reason=%s",i),null==r.signal){const e=AbortSignal.timeout(500);(0,fu.Wp)(1/0,e),r={...r,signal:e}}try{await Promise.all([...this._streams.values()].map((async e=>e.close(r)))),this.sendGoAway(i),this._closeMuxer()}catch(o){this.abort(o)}}abort(e,t){var n,r;if(!this.closeController.signal.aborted){t=null!==(n=t)&&void 0!==n?n:kd.InternalError,null===(r=this.log)||void 0===r||r.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,r){if(null!=this._streams.get(e))throw new fu.sv("Stream already exists",yd,{id:e});const i=new zd({id:e.toString(),name:t,state:n,direction:r,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var t;this.closeStream(e),null===(t=this.onStreamEnd)||void 0===t||t.call(this,i)},log:this.logger.forComponent("libp2p:yamux:".concat(r,":").concat(e)),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var e;const t=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(null===(e=this.log)||void 0===e||e.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{await Promise.race([t,new Promise((t=>{e=setTimeout(t,this.config.keepAliveInterval)}))]),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}catch(n){return void clearInterval(e)}}}async handleFrame(e,t){var n;const{streamID:r,type:i,length:o}=e;if(null===(n=this.log)||void 0===n||n.trace("received frame %o",e),0===r)switch(i){case Cd.Ping:return void this.handlePing(e);case Cd.GoAway:return void this.handleGoAway(o);default:throw new fu.sv("Invalid frame type",fd,{header:e})}else switch(e.type){case Cd.Data:case Cd.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new fu.sv("Invalid frame type",fd,{header:e})}}handlePing(e){if(e.flag===Td.SYN){var t;null===(t=this.log)||void 0===t||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Td.ACK)}else{if(e.flag!==Td.ACK)throw new fu.sv("Invalid frame flag",fd,{header:e});var n;null===(n=this.log)||void 0===n||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new fu.sv("ping not requested",pd);if(this.activePing.id!==e)throw new fu.sv("ping doesn't match our id",gd);this.activePing.resolve()}handleGoAway(e){var t,n;null===(t=this.log)||void 0===t||t.trace("received GoAway reason=%s",null!==(n=kd[e])&&void 0!==n?n:"unknown"),this.remoteGoAway=e;for(const r of this._streams.values())r.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:n,flag:r,type:i}=e;(r&Td.SYN)===Td.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(void 0!==o)switch(i){case Cd.WindowUpdate:return void o.handleWindowUpdate(e);case Cd.Data:if(void 0===t)throw new Error("unreachable");return void await o.handleData(e,t);default:throw new Error("unreachable")}else if(i===Cd.Data){var s;if(null===(s=this.log)||void 0===s||s.call(this,"discarding data for stream id=%s",n),void 0===t)throw new Error("unreachable");await t()}else{var a;null===(a=this.log)||void 0===a||a.call(this,"frame for missing stream id=%s",n)}}incomingStream(e){var t,n,r;if(this.client!==(e%2===0))throw new fu.sv("both endpoints are clients",vd);if(this._streams.has(e))return;if(null===(t=this.log)||void 0===t||t.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:Cd.WindowUpdate,flag:Td.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return null===(r=this.log)||void 0===r||r.call(this,"maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:Cd.WindowUpdate,flag:Td.RST,streamID:e,length:0});const i=this._newStream(e,void 0,Zd.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,i),null===(n=this.onIncomingStream)||void 0===n||n.call(this,i)}sendFrame(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("sending frame %o",e),e.type===Cd.Data){if(void 0===t)throw new fu.sv("invalid frame",fd);this.source.push(new Zs(Pd(e),t))}else this.source.push(Pd(e))}sendPing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Td.SYN;var n,r;t===Td.SYN?null===(n=this.log)||void 0===n||n.trace("sending ping request pingId=%s",e):null===(r=this.log)||void 0===r||r.trace("sending ping response pingId=%s",e);this.sendFrame({type:Cd.Ping,flag:t,streamID:0,length:e})}sendGoAway(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kd.NormalTermination;null===(e=this.log)||void 0===e||e.call(this,"sending GoAway reason=%s",kd[t]),this.localGoAway=t,this.sendFrame({type:Cd.GoAway,flag:0,streamID:0,length:t})}}function Gd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new Hd(t,e)}var Wd=n(97723);function Qd(e,t){(0,Wd.Z)(e,t),t.add(e)}function Yd(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}const Jd=Symbol.for("@libp2p/content-routing");class Xd extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"The operation was aborted"),(0,Yo.Z)(this,"code",void 0),(0,Yo.Z)(this,"type",void 0),this.code=Xd.code,this.type=Xd.type}}(0,Yo.Z)(Xd,"code","ABORT_ERR"),(0,Yo.Z)(Xd,"type","aborted");class $d extends Error{constructor(e,t,n){var r;super(e),(0,Yo.Z)(this,"code",void 0),(0,Yo.Z)(this,"props",void 0),this.code=t,this.name=null!==(r=null===n||void 0===n?void 0:n.name)&&void 0!==r?r:"CodeError",this.props=null!==n&&void 0!==n?n:{}}}class ef extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),(0,Yo.Z)(this,"code",void 0),this.code=ef.code}}(0,Yo.Z)(ef,"code","ERR_UNEXPECTED_PEER");class tf extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),(0,Yo.Z)(this,"code",void 0),this.code=tf.code}}(0,Yo.Z)(tf,"code","ERR_INVALID_CRYPTO_EXCHANGE");class nf extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto transmission"),(0,Yo.Z)(this,"code",void 0),this.code=nf.code}}(0,Yo.Z)(nf,"code","ERR_INVALID_CRYPTO_TRANSMISSION");const rf=Symbol.for("@libp2p/peer-routing");var of=n(18392),sf=n.n(of);var af=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const cf=af,lf=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class uf{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class hf{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ff(this,e)}}class df{constructor(e){this.decoders=e}or(e){return ff(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const ff=(e,t)=>new df({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class pf{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new uf(e,t,n),this.decoder=new hf(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const gf=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new pf(t,n,r,i)},yf=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=cf(r,n);return gf({prefix:t,name:n,encode:i,decode:e=>lf(o(e))})},mf=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return gf({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},vf=mf({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),bf=mf({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wf=mf({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ef=mf({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Af=mf({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Sf=mf({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_f=mf({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),If=mf({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Cf=mf({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Tf=yf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kf=yf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Rf=mf({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xf=mf({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pf=mf({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Df=mf({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Of(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}("".concat(e,":trace"));return sf().enabled("".concat(e,":trace"))&&null!=sf().names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=sf()("".concat(e,":trace"))),Object.assign(sf()(e),{error:sf()("".concat(e,":error")),trace:t})}sf().formatters.b=e=>null==e?"undefined":Tf.baseEncode(e),sf().formatters.t=e=>null==e?"undefined":vf.baseEncode(e),sf().formatters.m=e=>null==e?"undefined":Rf.baseEncode(e),sf().formatters.p=e=>null==e?"undefined":e.toString(),sf().formatters.c=e=>null==e?"undefined":e.toString(),sf().formatters.k=e=>null==e?"undefined":e.toString(),sf().formatters.a=e=>null==e?"undefined":e.toString();const Nf=Symbol.for("@libp2p/peer-id");const Bf=yf({prefix:"9",name:"base10",alphabet:"0123456789"}),Lf=mf({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Mf=mf({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Uf=mf({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ff=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Kf=Ff.reduce(((e,t,n)=>(e[n]=t,e)),[]),jf=Ff.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const Zf=gf({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Kf[t]),"")},decode:function(e){const t=[];for(const n of e){const e=jf[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),zf=yf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Vf=yf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Hf=mf({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),qf=gf({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Gf=new TextEncoder,Wf=new TextDecoder,Qf="json",Yf=512,Jf=e=>Gf.encode(JSON.stringify(e)),Xf=e=>JSON.parse(Wf.decode(e)),$f="raw",ep=85,tp=e=>lf(e),np=e=>lf(e);var rp=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=sp;)n[r++]=255&t|ip,t/=128;for(;t&op;)n[r++]=255&t|ip,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},ip=128,op=-128,sp=Math.pow(2,31);var ap=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&lp)<<o:(r&lp)*Math.pow(2,o),o+=7}while(r>=cp);return e.bytes=s-n,i},cp=128,lp=127;var up=Math.pow(2,7),hp=Math.pow(2,14),dp=Math.pow(2,21),fp=Math.pow(2,28),pp=Math.pow(2,35),gp=Math.pow(2,42),yp=Math.pow(2,49),mp=Math.pow(2,56),vp=Math.pow(2,63);const bp={encode:rp,decode:ap,encodingLength:function(e){return e<up?1:e<hp?2:e<dp?3:e<fp?4:e<pp?5:e<gp?6:e<yp?7:e<mp?8:e<vp?9:10}},wp=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[bp.decode(e,t),bp.decode.bytes]},Ep=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return bp.encode(e,t,n),t},Ap=e=>bp.encodingLength(e),Sp=(e,t)=>{const n=t.byteLength,r=Ap(e),i=r+Ap(n),o=new Uint8Array(i+n);return Ep(e,o,0),Ep(n,o,r),o.set(t,i),new Ip(e,n,t,o)},_p=e=>{const t=lf(e),[n,r]=wp(t),[i,o]=wp(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Ip(n,i,s,t)};class Ip{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const Cp=lf,Tp={code:0,name:"identity",encode:Cp,digest:e=>Sp(0,Cp(e))},kp=e=>{let{name:t,code:n,encode:r}=e;return new Rp(t,n,r)};class Rp{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Sp(this.code,t):t.then((e=>Sp(this.code,e)))}throw Error("Unknown type, must be binary type")}}const xp=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Pp=kp({name:"sha2-256",code:18,encode:xp("SHA-256")}),Dp=kp({name:"sha2-512",code:19,encode:xp("SHA-512")}),Op=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?Up(n,Bp(e),t||Tf.encoder):Fp(n,Bp(e),t||vf.encoder)},Np=new WeakMap,Bp=e=>{const t=Np.get(e);if(null==t){const t=new Map;return Np.set(e,t),t}return t};class Lp{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Kp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==jp)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Lp.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Sp(e,t);return Lp.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return Lp.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return Op(this,e)}toJSON(){return{"/":Op(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Lp)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Lp(e,n,r,i||Zp(e,n,r.bytes))}if(!0===t[zp]){const{version:e,multihash:n,code:r}=t,i=_p(n);return Lp.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Kp)throw new Error("Version 0 CID must use dag-pb (code: ".concat(Kp,") block encoding"));return new Lp(e,t,n,n.bytes);case 1:{const r=Zp(e,t,n.bytes);return new Lp(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Lp.create(0,Kp,e)}static createV1(e,t){return Lp.create(1,e,t)}static decode(e){const[t,n]=Lp.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Lp.inspectBytes(e),n=t.size-t.multihashSize,r=lf(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new Ip(t.multihashCode,t.digestSize,i,r);return[0===t.version?Lp.createV0(o):Lp.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=wp(e.subarray(t));return t+=r,n};let r=n(),i=Kp;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=Mp(e,t),i=Lp.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Bp(i).set(n,e),i}}const Mp=(e,t)=>{switch(e[0]){case"Q":{const n=t||Tf;return[Tf.prefix,n.decode("".concat(Tf.prefix).concat(e))]}case Tf.prefix:{const n=t||Tf;return[Tf.prefix,n.decode(e)]}case vf.prefix:{const n=t||vf;return[vf.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Up=(e,t,n)=>{const{prefix:r}=n;if(r!==Tf.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},Fp=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},Kp=112,jp=18,Zp=(e,t,n)=>{const r=Ap(e),i=r+Ap(t),o=new Uint8Array(i+n.byteLength);return Ep(e,o,0),Ep(t,o,r),o.set(n,i),o},zp=Symbol.for("@ipld/js-cid/CID"),Vp={...y,...d,...g,...u,...h,...a,...p,...c,...l,...f},Hp=Symbol.for("nodejs.util.inspect.custom"),qp=Object.values(Vp).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Vp.identity.decoder),Gp=114,Wp=36,Qp=37;class Yp{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,Nf,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=Tf.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Lp.createV1(Gp,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return eg(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Hp](){return"PeerId(".concat(this.toString(),")")}}class Jp extends Yp{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Xp extends Yp{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class $p extends Yp{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function eg(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:qp,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=_p(Tf.decode("z".concat(e)));return e.startsWith("12D")?new Xp({multihash:t}):e.startsWith("16U")?new $p({multihash:t}):new Jp({multihash:t})}return tg(qp.decode(e))}function tg(e){try{const t=_p(e);if(t.code===Tp.code){if(t.digest.length===Wp)return new Xp({multihash:t});if(t.digest.length===Qp)return new $p({multihash:t})}if(t.code===Pp.code)return new Jp({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Gp)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Pp.code)return new Jp({multihash:e.multihash});if(t.code===Tp.code){if(t.digest.length===Wp)return new Xp({multihash:e.multihash});if(t.digest.length===Qp)return new $p({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Lp.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var ng=n(95321);function rg(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)}for(const i of e){if(!0===(null===i||void 0===i?void 0:i.aborted)){n();break}null!=(null===i||void 0===i?void 0:i.addEventListener)&&i.addEventListener("abort",n)}const r=t.signal;return r.clear=function(){for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)},r}var ig=n(75584);const og=32,sg=64,ag=32;function cg(e,t){const n=new Uint8Array(sg);for(let r=0;r<ag;r++)n[r]=e[r],n[ag+r]=t[r];return n}const lg={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},ug={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function hg(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=lg.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",ug,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",ug,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",ug,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return Rf.encode(r)}var dg,fg,pg,gg;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(dg||(dg={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(fg||(fg={})),function(e){e.codec=()=>bs(fg)}(dg||(dg={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),dg.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=dg.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(pg||(pg={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),dg.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=dg.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(gg||(gg={}));class yg{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=Ag(e,og)}async verify(e,t){return async function(e,t,n){return ql.verify(t,n,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return pg.encode({Type:dg.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}}class mg{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=Ag(e,sg),this._publicKey=Ag(t,og)}async sign(e){return async function(e,t){const n=e.subarray(0,ag);return ql.sign(t,n)}(this._key,e)}get public(){return new yg(this._publicKey)}marshal(){return this._key}get bytes(){return gg.encode({Type:dg.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}async id(){const e=Tp.digest(this.public.bytes);return Tf.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return hg(this.bytes,e);throw new $d("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function vg(e){if(e.length>sg){const t=(e=Ag(e,sg+og)).subarray(0,sg),n=e.subarray(sg,e.length);return new mg(t,n)}const t=(e=Ag(e,sg)).subarray(0,sg),n=e.subarray(og);return new mg(t,n)}function bg(e){return e=Ag(e,og),new yg(e)}async function wg(){const{privateKey:e,publicKey:t}=await async function(){const e=ql.utils.randomPrivateKey(),t=ql.getPublicKey(e);return{privateKey:cg(e,t),publicKey:t}}();return new mg(e,t)}async function Eg(e){const{privateKey:t,publicKey:n}=await async function(e){if(e.length!==ag)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=ql.getPublicKey(t);return{privateKey:cg(t,n),publicKey:n}}(e);return new mg(t,n)}function Ag(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new $d("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}function Sg(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Au.B)(n,"base64url")}function _g(e){const t=function(e,t){let n=(0,yu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(gu().jsbn.BigInteger)((0,Au.B)(t,"base16"),16)}const Ig={"P-256":256,"P-384":384,"P-521":521};Object.keys(Ig).join(" / ");function Cg(e,t){return t.map((t=>_g(e[t])))}async function Tg(e){const t=[await lg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Rg(e)],n=await kg({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function kg(e){if(null==e.privateKey||null==e.publicKey)throw new $d("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([lg.get().subtle.exportKey("jwk",e.privateKey),lg.get().subtle.exportKey("jwk",e.publicKey)])}async function Rg(e){return lg.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xg(e,t,n,r){const i=t?function(e){return gu().pki.setRsaPublicKey(...Cg(e,["n","e"]))}(e):function(e){return gu().pki.setRsaPrivateKey(...Cg(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Au.B)(Uint8Array.from(n),"ascii"),i);return(0,yu.m)(o,"ascii")}function Pg(e){if("RSA"!==e.kty)throw new $d("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new $d("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,yu.m)(e.n,"base64url").length}const Dg=8192;class Og{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}async verify(e,t){return async function(e,t,n){const r=await lg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return lg.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new $d("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.publicKeyToAsn1({n:_g(e.n),e:_g(e.e)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return pg.encode({Type:dg.RSA,Data:this.marshal()}).subarray()}encrypt(e){return xg(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}}class Ng{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new $d("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return _c(e)}(16)}async sign(e){return async function(e,t){const n=await lg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await lg.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,Uint8Array.from(t));return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new $d("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Og(this._publicKey)}decrypt(e){return xg(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new $d("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.privateKeyToAsn1({n:_g(e.n),e:_g(e.e),d:_g(e.d),p:_g(e.p),q:_g(e.q),dP:_g(e.dp),dQ:_g(e.dq),qInv:_g(e.qi)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return gg.encode({Type:dg.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(gu().util.ByteBuffer)(this.marshal()),n=gu().asn1.fromDer(t),r=gu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return gu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return hg(this.bytes,e);throw new $d("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function Bg(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Sg(n.n),e:Sg(n.e),d:Sg(n.d),p:Sg(n.p),q:Sg(n.q),dp:Sg(n.dP),dq:Sg(n.dQ),qi:Sg(n.qInv),alg:"RS256"}}(e);if(Pg(t)>Dg)throw new $d("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await Tg(t);return new Ng(n.privateKey,n.publicKey)}function Lg(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Sg(n.n),e:Sg(n.e)}}(e);if(Pg(t)>Dg)throw new $d("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Og(t)}async function Mg(e){if(Pg(e)>Dg)throw new $d("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Tg(e);return new Ng(t.privateKey,t.publicKey)}async function Ug(e){if(e>Dg)throw new $d("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await lg.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await kg(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new Ng(t.privateKey,t.publicKey)}function Fg(e){try{Eh.ProjectivePoint.fromHex(e)}catch(t){throw new $d(String(t),"ERR_INVALID_PUBLIC_KEY")}}class Kg{constructor(e){(0,Yo.Z)(this,"_key",void 0),Fg(e),this._key=e}async verify(e,t){return async function(e,t,n){try{const{digest:r}=await Pp.digest(n);return Eh.verify(t,r,e)}catch(r){throw new $d(String(r),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Eh.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return pg.encode({Type:dg.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}}class jg{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Eh.getPublicKey(e,!0)}catch(t){throw new $d(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Eh.getPublicKey(e,!0)}catch(t){throw new $d(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Fg(this._publicKey)}async sign(e){return async function(e,t){const{digest:n}=await Pp.digest(t);try{return Eh.sign(n,e).toDERRawBytes()}catch(r){throw new $d(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Kg(this._publicKey)}marshal(){return this._key}get bytes(){return gg.encode({Type:dg.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Pp.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return hg(this.bytes,e);throw new $d("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Zg(e){return new jg(e)}function zg(e){return new Kg(e)}async function Vg(){const e=Eh.utils.randomPrivateKey();return new jg(e)}const Hg={rsa:A,ed25519:E,secp256k1:S};function qg(e){const t=Object.keys(Hg).join(" / ");return new $d("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function Gg(e){var t,n;const r=pg.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case dg.RSA:return Hg.rsa.unmarshalRsaPublicKey(i);case dg.Ed25519:return Hg.ed25519.unmarshalEd25519PublicKey(i);case dg.Secp256k1:return Hg.secp256k1.unmarshalSecp256k1PublicKey(i);default:throw qg(null!==(n=r.Type)&&void 0!==n?n:"unknown")}}const Wg="/",Qg=(new TextEncoder).encode(Wg);Qg[0];Symbol.toStringTag;var Yg,Jg=n(92244),Xg=n.n(Jg);!function(e){let t,n,r;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(n||(n={})),function(e){e.codec=()=>bs(n)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==r&&(r=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signatureV1&&(n.uint32(18),n.bytes(t.signatureV1)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.value=t.bytes();break;case 2:r.signatureV1=t.bytes();break;case 3:r.validityType=e.ValidityType.codec().decode(t);break;case 4:r.validity=t.bytes();break;case 5:r.sequence=t.uint64();break;case 6:r.ttl=t.uint64();break;case 7:r.pubKey=t.bytes();break;case 8:r.signatureV2=t.bytes();break;case 9:r.data=t.bytes();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Yg||(Yg={}));const $g=["string","number","bigint","symbol"],ey=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function ty(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if($g.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const n=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(ey.includes(t))return t;return}(e);return n||"Object"}class ny{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return"Type[".concat(this.major,"].").concat(this.name)}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}ny.uint=new ny(0,"uint",!0),ny.negint=new ny(1,"negint",!0),ny.bytes=new ny(2,"bytes",!0),ny.string=new ny(3,"string",!0),ny.array=new ny(4,"array",!1),ny.map=new ny(5,"map",!1),ny.tag=new ny(6,"tag",!1),ny.float=new ny(7,"float",!0),ny.false=new ny(7,"false",!0),ny.true=new ny(7,"true",!0),ny.null=new ny(7,"null",!0),ny.undefined=new ny(7,"undefined",!0),ny.break=new ny(7,"break",!0);class ry{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return"Token[".concat(this.type,"].").concat(this.value)}}const iy=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,oy=new TextDecoder,sy=new TextEncoder;function ay(e){return iy&&globalThis.Buffer.isBuffer(e)}const cy=iy?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):py(e,t,n):(e,t,n)=>n-t>64?oy.decode(e.subarray(t,n)):py(e,t,n),ly=iy?e=>e.length>64?globalThis.Buffer.from(e):fy(e):e=>e.length>64?sy.encode(e):fy(e),uy=iy?(e,t,n)=>ay(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),hy=iy?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),function(e){return e instanceof Uint8Array?ay(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let i of e)r+i.length>n.length&&(i=i.subarray(0,n.length-r)),n.set(i,r),r+=i.length;return n},dy=iy?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function fy(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function py(e,t,n){const r=[];for(;t<n;){const i=e[t];let o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=n){let n,r,a,c;switch(s){case 1:i<128&&(o=i);break;case 2:n=e[t+1],128===(192&n)&&(c=(31&i)<<6|63&n,c>127&&(o=c));break;case 3:n=e[t+1],r=e[t+2],128===(192&n)&&128===(192&r)&&(c=(15&i)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),t+=s}return function(e){const t=e.length;if(t<=gy)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=gy));return n}(r)}const gy=4096;const yy="CBOR decode error:",my="CBOR encode error:",vy=[];function by(e,t,n){if(e.length-t<n)throw new Error("".concat(yy," not enough data for type"))}vy[23]=1,vy[24]=2,vy[25]=3,vy[26]=5,vy[27]=9;const wy=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ey(e,t,n){by(e,t,1);const r=e[t];if(!0===n.strict&&r<wy[0])throw new Error("".concat(yy," integer encoded in more bytes than necessary (strict decode)"));return r}function Ay(e,t,n){by(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<wy[1])throw new Error("".concat(yy," integer encoded in more bytes than necessary (strict decode)"));return r}function Sy(e,t,n){by(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<wy[2])throw new Error("".concat(yy," integer encoded in more bytes than necessary (strict decode)"));return r}function _y(e,t,n){by(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&o<wy[3])throw new Error("".concat(yy," integer encoded in more bytes than necessary (strict decode)"));if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(!0===n.allowBigInt)return o;throw new Error("".concat(yy," integers outside of the safe integer range are not supported"))}function Iy(e,t){return Cy(e,0,t.value)}function Cy(e,t,n){if(n<wy[0]){const r=Number(n);e.push([t|r])}else if(n<wy[1]){const r=Number(n);e.push([24|t,r])}else if(n<wy[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<wy[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<wy[4]))throw new Error("".concat(yy," encountered BigInt larger than allowable range"));{const n=[27|t,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),o=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&o,o>>=8,n[3]=255&o,o>>=8,n[2]=255&o,o>>=8,n[1]=255&o,e.push(n)}}}Iy.encodedSize=function(e){return Cy.encodedSize(e.value)},Cy.encodedSize=function(e){return e<wy[0]?1:e<wy[1]?2:e<wy[2]?3:e<wy[3]?5:9},Iy.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Ty=BigInt(-1),ky=BigInt(1);function Ry(e,t){const n=t.value,r="bigint"===typeof n?n*Ty-ky:-1*n-1;Cy(e,t.type.majorEncoded,r)}function xy(e,t,n,r){by(e,t,n+r);const i=uy(e,t+n,t+n+r);return new ry(ny.bytes,i,n+r)}function Py(e,t,n,r){return xy(e,t,1,n)}function Dy(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===ny.string?ly(e.value):e.value),e.encodedBytes}function Oy(e,t){const n=Dy(t);Cy(e,t.type.majorEncoded,n.length),e.push(n)}function Ny(e,t,n,r,i){const o=n+r;by(e,t,o);const s=new ry(ny.string,cy(e,t+n,t+o),o);return!0===i.retainStringBytes&&(s.byteValue=uy(e,t+n,t+o)),s}function By(e,t,n,r){return Ny(e,t,1,n,r)}Ry.encodedSize=function(e){const t=e.value,n="bigint"===typeof t?t*Ty-ky:-1*t-1;return n<wy[0]?1:n<wy[1]?2:n<wy[2]?3:n<wy[3]?5:9},Ry.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Oy.encodedSize=function(e){const t=Dy(e);return Cy.encodedSize(t.length)+t.length},Oy.compareTokens=function(e,t){return n=Dy(e),r=Dy(t),n.length<r.length?-1:n.length>r.length?1:function(e,t){if(ay(e)&&ay(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}(n,r);var n,r};const Ly=Oy;function My(e,t,n,r){return new ry(ny.array,r,n)}function Uy(e,t,n,r){return My(0,0,1,n)}function Fy(e,t){Cy(e,ny.array.majorEncoded,t.value)}function Ky(e,t,n,r){return new ry(ny.map,r,n)}function jy(e,t,n,r){return Ky(0,0,1,n)}function Zy(e,t){Cy(e,ny.map.majorEncoded,t.value)}function zy(e,t,n,r){return new ry(ny.tag,n,1)}function Vy(e,t){Cy(e,ny.tag.majorEncoded,t.value)}Fy.compareTokens=Iy.compareTokens,Fy.encodedSize=function(e){return Cy.encodedSize(e.value)},Zy.compareTokens=Iy.compareTokens,Zy.encodedSize=function(e){return Cy.encodedSize(e.value)},Vy.compareTokens=Iy.compareTokens,Vy.encodedSize=function(e){return Cy.encodedSize(e.value)};const Hy=20,qy=21,Gy=22,Wy=23;function Qy(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error("".concat(yy," NaN values are not supported"));if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error("".concat(yy," Infinity values are not supported"))}return new ry(ny.float,e,t)}function Yy(e,t,n){const r=t.value;if(!1===r)e.push([ny.float.majorEncoded|Hy]);else if(!0===r)e.push([ny.float.majorEncoded|qy]);else if(null===r)e.push([ny.float.majorEncoded|Gy]);else if(void 0===r)e.push([ny.float.majorEncoded|Wy]);else{let t,o=!1;n&&!0===n.float64||(em(r),t=tm($y,1),r===t||Number.isNaN(r)?($y[0]=249,e.push($y.slice(0,3)),o=!0):(nm(r),t=rm($y,1),r===t&&($y[0]=250,e.push($y.slice(0,5)),o=!0))),o||(i=r,Xy.setFloat64(0,i,!1),t=im($y,1),$y[0]=251,e.push($y.slice(0,9)))}var i}Yy.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!t||!0!==t.float64){em(n);let e=tm($y,1);if(n===e||Number.isNaN(n))return 3;if(nm(n),e=rm($y,1),n===e)return 5}return 9};const Jy=new ArrayBuffer(9),Xy=new DataView(Jy,1),$y=new Uint8Array(Jy,0);function em(e){if(e===1/0)Xy.setUint16(0,31744,!1);else if(e===-1/0)Xy.setUint16(0,64512,!1);else if(Number.isNaN(e))Xy.setUint16(0,32256,!1);else{Xy.setFloat32(0,e);const t=Xy.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)Xy.setUint16(0,31744,!1);else if(0===n)Xy.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?Xy.setUint16(0,0):e<-14?Xy.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):Xy.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function tm(e,t){if(e.length-t<2)throw new Error("".concat(yy," not enough data for float16"));const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let o;return o=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-o:o}function nm(e){Xy.setFloat32(0,e,!1)}function rm(e,t){if(e.length-t<4)throw new Error("".concat(yy," not enough data for float32"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function im(e,t){if(e.length-t<8)throw new Error("".concat(yy," not enough data for float64"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function om(e,t,n){throw new Error("".concat(yy," encountered invalid minor (").concat(n,") for major ").concat(e[t]>>>5))}function sm(e){return()=>{throw new Error("".concat(yy," ").concat(e))}}Yy.compareTokens=Iy.compareTokens;const am=[];for(let Ige=0;Ige<=23;Ige++)am[Ige]=om;am[24]=function(e,t,n,r){return new ry(ny.uint,Ey(e,t+1,r),2)},am[25]=function(e,t,n,r){return new ry(ny.uint,Ay(e,t+1,r),3)},am[26]=function(e,t,n,r){return new ry(ny.uint,Sy(e,t+1,r),5)},am[27]=function(e,t,n,r){return new ry(ny.uint,_y(e,t+1,r),9)},am[28]=om,am[29]=om,am[30]=om,am[31]=om;for(let Ige=32;Ige<=55;Ige++)am[Ige]=om;am[56]=function(e,t,n,r){return new ry(ny.negint,-1-Ey(e,t+1,r),2)},am[57]=function(e,t,n,r){return new ry(ny.negint,-1-Ay(e,t+1,r),3)},am[58]=function(e,t,n,r){return new ry(ny.negint,-1-Sy(e,t+1,r),5)},am[59]=function(e,t,n,r){const i=_y(e,t+1,r);if("bigint"!==typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ry(ny.negint,e,9)}if(!0!==r.allowBigInt)throw new Error("".concat(yy," integers outside of the safe integer range are not supported"));return new ry(ny.negint,Ty-BigInt(i),9)},am[60]=om,am[61]=om,am[62]=om,am[63]=om;for(let Ige=64;Ige<=87;Ige++)am[Ige]=Py;am[88]=function(e,t,n,r){return xy(e,t,2,Ey(e,t+1,r))},am[89]=function(e,t,n,r){return xy(e,t,3,Ay(e,t+1,r))},am[90]=function(e,t,n,r){return xy(e,t,5,Sy(e,t+1,r))},am[91]=function(e,t,n,r){const i=_y(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(yy," 64-bit integer bytes lengths not supported"));return xy(e,t,9,i)},am[92]=om,am[93]=om,am[94]=om,am[95]=sm("indefinite length bytes/strings are not supported");for(let Ige=96;Ige<=119;Ige++)am[Ige]=By;am[120]=function(e,t,n,r){return Ny(e,t,2,Ey(e,t+1,r),r)},am[121]=function(e,t,n,r){return Ny(e,t,3,Ay(e,t+1,r),r)},am[122]=function(e,t,n,r){return Ny(e,t,5,Sy(e,t+1,r),r)},am[123]=function(e,t,n,r){const i=_y(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(yy," 64-bit integer string lengths not supported"));return Ny(e,t,9,i,r)},am[124]=om,am[125]=om,am[126]=om,am[127]=sm("indefinite length bytes/strings are not supported");for(let Ige=128;Ige<=151;Ige++)am[Ige]=Uy;am[152]=function(e,t,n,r){return My(0,0,2,Ey(e,t+1,r))},am[153]=function(e,t,n,r){return My(0,0,3,Ay(e,t+1,r))},am[154]=function(e,t,n,r){return My(0,0,5,Sy(e,t+1,r))},am[155]=function(e,t,n,r){const i=_y(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(yy," 64-bit integer array lengths not supported"));return My(0,0,9,i)},am[156]=om,am[157]=om,am[158]=om,am[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(yy," indefinite length items not allowed"));return My(0,0,1,1/0)};for(let Ige=160;Ige<=183;Ige++)am[Ige]=jy;am[184]=function(e,t,n,r){return Ky(0,0,2,Ey(e,t+1,r))},am[185]=function(e,t,n,r){return Ky(0,0,3,Ay(e,t+1,r))},am[186]=function(e,t,n,r){return Ky(0,0,5,Sy(e,t+1,r))},am[187]=function(e,t,n,r){const i=_y(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(yy," 64-bit integer map lengths not supported"));return Ky(0,0,9,i)},am[188]=om,am[189]=om,am[190]=om,am[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(yy," indefinite length items not allowed"));return Ky(0,0,1,1/0)};for(let Ige=192;Ige<=215;Ige++)am[Ige]=zy;am[216]=function(e,t,n,r){return new ry(ny.tag,Ey(e,t+1,r),2)},am[217]=function(e,t,n,r){return new ry(ny.tag,Ay(e,t+1,r),3)},am[218]=function(e,t,n,r){return new ry(ny.tag,Sy(e,t+1,r),5)},am[219]=function(e,t,n,r){return new ry(ny.tag,_y(e,t+1,r),9)},am[220]=om,am[221]=om,am[222]=om,am[223]=om;for(let Ige=224;Ige<=243;Ige++)am[Ige]=sm("simple values are not supported");am[244]=om,am[245]=om,am[246]=om,am[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw new Error("".concat(yy," undefined values are not supported"));return!0===r.coerceUndefinedToNull?new ry(ny.null,null,1):new ry(ny.undefined,void 0,1)},am[248]=sm("simple values are not supported"),am[249]=function(e,t,n,r){return Qy(tm(e,t+1),3,r)},am[250]=function(e,t,n,r){return Qy(rm(e,t+1),5,r)},am[251]=function(e,t,n,r){return Qy(im(e,t+1),9,r)},am[252]=om,am[253]=om,am[254]=om,am[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(yy," indefinite length items not allowed"));return new ry(ny.break,void 0,1)};const cm=[];for(let Ige=0;Ige<24;Ige++)cm[Ige]=new ry(ny.uint,Ige,1);for(let Ige=-1;Ige>=-24;Ige--)cm[31-Ige]=new ry(ny.negint,Ige,1);cm[64]=new ry(ny.bytes,new Uint8Array(0),1),cm[96]=new ry(ny.string,"",1),cm[128]=new ry(ny.array,0,1),cm[160]=new ry(ny.map,0,1),cm[244]=new ry(ny.false,!1,1),cm[245]=new ry(ny.true,!0,1),cm[246]=new ry(ny.null,null,1);(function(){const e=[];e[ny.uint.major]=Iy,e[ny.negint.major]=Ry,e[ny.bytes.major]=Oy,e[ny.string.major]=Ly,e[ny.array.major]=Fy,e[ny.map.major]=Zy,e[ny.tag.major]=Vy,e[ny.float.major]=Yy})(),new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=dy(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1===this.chunks.length){const n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=uy(n,0,this.cursor)}else e=hy(this.chunks,this.cursor);return t&&this.reset(),e}};class lm{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error("".concat(my," object contains circular references"));return new lm(t,e)}}const um={null:new ry(ny.null,null),undefined:new ry(ny.undefined,void 0),true:new ry(ny.true,!0),false:new ry(ny.false,!1),emptyArray:new ry(ny.array,0),emptyMap:new ry(ny.map,0)},hm={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ry(e>=0?ny.uint:ny.negint,e):new ry(ny.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new ry(ny.uint,e):new ry(ny.negint,e),Uint8Array:(e,t,n,r)=>new ry(ny.bytes,e),string:(e,t,n,r)=>new ry(ny.string,e),boolean:(e,t,n,r)=>e?um.true:um.false,null:(e,t,n,r)=>um.null,undefined:(e,t,n,r)=>um.undefined,ArrayBuffer:(e,t,n,r)=>new ry(ny.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new ry(ny.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[um.emptyArray,new ry(ny.break)]:um.emptyArray;r=lm.createCheck(r,e);const i=[];let o=0;for(const s of e)i[o++]=dm(s,n,r);return n.addBreakTokens?[new ry(ny.array,e.length),i,new ry(ny.break)]:[new ry(ny.array,e.length),i]},Object(e,t,n,r){const i="Object"!==t,o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return!0===n.addBreakTokens?[um.emptyMap,new ry(ny.break)]:um.emptyMap;r=lm.createCheck(r,e);const a=[];let c=0;for(const l of o)a[c++]=[dm(l,n,r),dm(i?e.get(l):e[l],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,n),n.addBreakTokens?[new ry(ny.map,s),a,new ry(ny.break)]:[new ry(ny.map,s),a]}};hm.Map=hm.Object,hm.Buffer=hm.Uint8Array;for(const Ige of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))hm["".concat(Ige,"Array")]=hm.DataView;function dm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=ty(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||hm[r];if("function"===typeof i){const o=i(e,r,t,n);if(null!=o)return o}const o=hm[r];if(!o)throw new Error("".concat(my," unsupported type: ").concat(r));return o(e,r,t,n)}const fm={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class pm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=cm[e];if(void 0===t){const n=am[e];if(!n)throw new Error("".concat(yy," no decoder for major type ").concat(e>>>5," (byte 0x").concat(e.toString(16).padStart(2,"0"),")"));const r=31&e;t=n(this.data,this._pos,r,this.options)}return this._pos+=t.encodedLength,t}}const gm=Symbol.for("DONE"),ym=Symbol.for("BREAK");function mm(e,t){if(e.done())return gm;const n=e.next();if(n.type===ny.break)return ym;if(n.type.terminal)return n.value;if(n.type===ny.array)return function(e,t,n){const r=[];for(let i=0;i<e.value;i++){const o=mm(t,n);if(o===ym){if(e.value===1/0)break;throw new Error("".concat(yy," got unexpected break to lengthed array"))}if(o===gm)throw new Error("".concat(yy," found array but not enough entries (got ").concat(i,", expected ").concat(e.value,")"));r[i]=o}return r}(n,e,t);if(n.type===ny.map)return function(e,t,n){const r=!0===n.useMaps,i=r?void 0:{},o=r?new Map:void 0;for(let s=0;s<e.value;s++){const a=mm(t,n);if(a===ym){if(e.value===1/0)break;throw new Error("".concat(yy," got unexpected break to lengthed map"))}if(a===gm)throw new Error("".concat(yy," found map but not enough entries (got ").concat(s," [no key], expected ").concat(e.value,")"));if(!0!==r&&"string"!==typeof a)throw new Error("".concat(yy," non-string keys not supported (got ").concat(typeof a,")"));if(!0===n.rejectDuplicateMapKeys&&(r&&o.has(a)||!r&&a in i))throw new Error("".concat(yy,' found repeat map key "').concat(a,'"'));const c=mm(t,n);if(c===gm)throw new Error("".concat(yy," found map but not enough entries (got ").concat(s," [no value], expected ").concat(e.value,")"));r?o.set(a,c):i[a]=c}return r?o:i}(n,e,t);if(n.type===ny.tag){if(t.tags&&"function"===typeof t.tags[n.value]){const r=mm(e,t);return t.tags[n.value](r)}throw new Error("".concat(yy," tag not supported (").concat(n.value,")"))}throw new Error("unsupported")}function vm(e,t){const[n,r]=function(e,t){if(!(e instanceof Uint8Array))throw new Error("".concat(yy," data to decode must be a Uint8Array"));const n=(t=Object.assign({},fm,t)).tokenizer||new pm(e,t),r=mm(n,t);if(r===gm)throw new Error("".concat(yy," did not find any content to decode"));if(r===ym)throw new Error("".concat(yy," got unexpected break"));return[r,e.subarray(n.pos())]}(e,t);if(r.length>0)throw new Error("".concat(yy," too many terminals, data makes no sense"));return n}const bm="ERR_UNRECOGNIZED_VALIDITY",wm="ERR_SIGNATURE_VERIFICATION",Em="ERR_UNRECOGNIZED_FORMAT",Am="ERR_UNDEFINED_PARAMETER",Sm=Of("ipns:utils"),_m=(0,yu.m)("/ipns/");const Im=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw Sm.error(e),Xo()(e,Am)}let n;if(null!=t.pubKey){try{n=Gg(t.pubKey)}catch(r){throw Sm.error(r),r}if(!(await async function(e,t){return e.length===Wp?new Xp({multihash:Sp(Tp.code,e),privateKey:t}):e.length===Qp?new $p({multihash:Sp(Tp.code,e),privateKey:t}):new Jp({multihash:await Pp.digest(e),publicKey:e,privateKey:t})}(t.pubKey)).equals(e))throw Xo()(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(n=Gg(e.publicKey));if(null!=n)return n;throw Xo()(new Error("no public key is available"),Am)},Cm=e=>"signatureV1"in e?Yg.encode({value:(0,yu.m)(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:(0,yu.m)(e.validity.toString()),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):Yg.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data});function Tm(e){const t=Yg.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw Xo()(new Error("missing data or signatureV2"),wm);const n=km(t.data),r=Rm(n.Value);let i;try{i=Xg().fromDate(function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),i=parseInt(n[2],10)-1,o=parseInt(n[3],10),s=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].padEnd(6,"0").slice(0,3),10);return new Date(Date.UTC(r,i,o,s,a,c,l))}((0,Au.B)(n.Validity)))}catch(o){throw Sm.error("unrecognized validity format (not an rfc3339 format)"),Xo()(new Error("unrecognized validity format (not an rfc3339 format)"),Em)}if(null!=t.value&&null!=t.signatureV1)return xm(t),{value:r,validityType:Yg.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:r,validityType:Yg.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const km=e=>{const t=vm(e);if(0!==t.ValidityType)throw Xo()(new Error("Unknown validity type"),bm);return t.ValidityType=Yg.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},Rm=e=>{if(null!=e){if(null!=(t=e)&&Boolean(t[Nf]))return"/ipns/".concat(e.toCID().toString(zf));if(e instanceof Uint8Array){const t=(0,Au.B)(e);t.startsWith("/")&&(e=t)}const n=e.toString().trim();if(n.startsWith("/")&&n.length>1)return n;const r=Lp.asCID(e);if(null!=r)return 114===r.code?"/ipns/".concat(r.toString(zf)):"/ipfs/".concat(r.toV1().toString());try{return e instanceof Uint8Array?"/ipfs/".concat(Lp.decode(e).toV1().toString()):"/ipfs/".concat(Lp.parse(n).toV1().toString())}catch{}}var t;throw Xo()(new Error("Value must be a valid content path starting with /"),"ERR_INVALID_VALUE")},xm=e=>{var t,n;if(null==e.data)throw Xo()(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const r=km(e.data);if(!(0,Ms.f)(r.Value,null!==(t=e.value)&&void 0!==t?t:new Uint8Array(0)))throw Xo()(new Error('Field "value" did not match between protobuf and CBOR'),wm);if(!(0,Ms.f)(r.Validity,null!==(n=e.validity)&&void 0!==n?n:new Uint8Array(0)))throw Xo()(new Error('Field "validity" did not match between protobuf and CBOR'),wm);if(r.ValidityType!==e.validityType)throw Xo()(new Error('Field "validityType" did not match between protobuf and CBOR'),wm);if(r.Sequence!==e.sequence)throw Xo()(new Error('Field "sequence" did not match between protobuf and CBOR'),wm);if(r.TTL!==e.ttl)throw Xo()(new Error('Field "ttl" did not match between protobuf and CBOR'),wm)};Of("ipns"),Tp.code;const Pm=Of("ipns:validator"),Dm=async(e,t)=>{const n=Tm(t);let r;try{const t=(e=>{const t=(0,yu.m)("ipns-signature:");return(0,Ls.z)([t,e])})(n.data);r=await e.verify(t,n.signatureV2)}catch(i){r=!1}if(!r)throw Pm.error("record signature verification failed"),Xo()(new Error("record signature verification failed"),wm);if(n.validityType===Yg.ValidityType.EOL){if(n.validity.toDate().getTime()<Date.now())throw Pm.error("record has expired"),Xo()(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=n.validityType)throw Pm.error("unrecognized validity type"),Xo()(new Error("unrecognized validity type"),bm);Pm("ipns record for %b is valid",n.value)};async function Om(e,t){if(t.byteLength>10240)throw Xo()(new Error("record too large"),"ERR_RECORD_TOO_LARGE");const n=(e=>tg(e.slice(_m.length)))(e),r=Tm(t),i=await Im(n,r);await Dm(i,t)}async function*Nm(e){const t=/\r?\n/,n=new TextDecoder("utf8");let r="";for await(let o of e){var i;"string"===typeof o&&(o=(new TextEncoder).encode(o)),r+=n.decode(o,{stream:!0});const e=r.split(t);r=null!==(i=e.pop())&&void 0!==i?i:"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}r+=n.decode(),""!==r&&(yield JSON.parse(r))}var Bm=n(68702);const Lm=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};const Mm=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};const Um=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)yield t(n)}();const n=Mm(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){yield await o;for await(const e of n)yield t(e)}();const s=t;return function*(){yield o;for(const e of n)yield s(e)}()},Fm=(0,yu.m)("/ipns/");function Km(e){return(0,Ms.f)(e.subarray(0,Fm.byteLength),Fm)}const jm=e=>tg(e.slice(Fm.length));class Zm{constructor(e){(0,Yo.Z)(this,"client",void 0),this.client=e}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*Um(t.client.getProviders(e,n),(e=>{var t;return{id:e.ID,multiaddrs:null!==(t=e.Addrs)&&void 0!==t?t:[],protocols:[]}}))}()}catch(n){return Promise.reject(n)}}async provide(){}async put(e,t,n){if(!Km(e))return;const r=jm(e),i=Tm(t);await this.client.putIPNS(r,i,n)}async get(e,t){if(!Km(e))throw new $d("Not found","ERR_NOT_FOUND");const n=jm(e);try{const e=await this.client.getIPNS(n,t);return Cm(e)}catch(r){if("ERR_BAD_RESPONSE"===r.code)throw new $d("Not found","ERR_NOT_FOUND");throw r}}}class zm{constructor(e){(0,Yo.Z)(this,"client",void 0),this.client=e}async findPeer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await Lm(this.client.getPeers(e,t));if(null!=n)return{id:n.ID,multiaddrs:n.Addrs,protocols:[]};throw new $d("Not found","ERR_NOT_FOUND")}getClosestPeers(e){try{return async function*(){}()}catch(t){return Promise.reject(t)}}}const Vm=Of("delegated-routing-v1-http-api-client"),Hm=4,qm=3e4;var Gm=new WeakSet,Wm=new WeakSet;class Qm{constructor(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Qd(this,Wm),Qd(this,Gm),(0,Yo.Z)(this,"started",void 0),(0,Yo.Z)(this,"httpQueue",void 0),(0,Yo.Z)(this,"shutDownController",void 0),(0,Yo.Z)(this,"clientUrl",void 0),(0,Yo.Z)(this,"timeout",void 0),(0,Yo.Z)(this,"contentRouting",void 0),(0,Yo.Z)(this,"peerRouting",void 0),this.started=!1,this.shutDownController=new AbortController,this.httpQueue=new Bm.Z({concurrency:null!==(t=r.concurrentRequests)&&void 0!==t?t:Hm}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=null!==(n=r.timeout)&&void 0!==n?n:qm,this.contentRouting=new Zm(this),this.peerRouting=new zm(this)}get[Jd](){return this.contentRouting}get[rf](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}getProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){Vm("getProviders starts: %c",e);const r=rg([t.shutDownController.signal,n.signal,AbortSignal.timeout(t.timeout)]),i=Ws(),o=Ws();t.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n="".concat(t.clientUrl,"routing/v1/providers/").concat(e.toString()),o={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,o);if(null==s.body)throw new $d("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const n of e.Providers){const e=Yd(t,Gm,Ym).call(t,n);null!=e&&(yield e)}}else for await(const e of Nm((0,ig.Z)(s.body))){const n=Yd(t,Gm,Ym).call(t,e);null!=n&&(yield n)}}catch(s){Vm.error("getProviders errored:",s)}finally{r.clear(),o.resolve(),Vm("getProviders finished: %c",e)}}()}catch(n){return Promise.reject(n)}}getPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){Vm("getPeers starts: %c",e);const r=rg([t.shutDownController.signal,n.signal,AbortSignal.timeout(t.timeout)]),i=Ws(),o=Ws();t.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n="".concat(t.clientUrl,"routing/v1/peers/").concat(e.toCID().toString()),o={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,o);if(null==s.body)throw new $d("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const n=await s.json();for(const r of n.Peers){const n=Yd(t,Wm,Jm).call(t,e,r);null!=n&&(yield n)}}else for await(const r of Nm((0,ig.Z)(s.body))){const n=Yd(t,Wm,Jm).call(t,e,r);null!=n&&(yield n)}}catch(s){Vm.error("getPeers errored:",s)}finally{r.clear(),o.resolve(),Vm("getPeers finished: %c",e)}}()}catch(n){return Promise.reject(n)}}async getIPNS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Vm("getIPNS starts: %c",e);const n=rg([this.shutDownController.signal,t.signal,AbortSignal.timeout(this.timeout)]),r=Ws(),i=Ws();this.httpQueue.add((async()=>(r.resolve(),i.promise)));try{await r.promise;const t="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString()),i={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:n},o=await fetch(t,i);if(null==o.body)throw new $d("GET ipns response had no body","ERR_BAD_RESPONSE");const s=new Uint8Array(await o.arrayBuffer());return await Om((e=>(0,Ls.z)([_m,e.toBytes()]))(e),s),Tm(s)}finally{n.clear(),i.resolve(),Vm("getIPNS finished: %c",e)}}async putIPNS(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Vm("getIPNS starts: %c",e);const r=rg([this.shutDownController.signal,n.signal,AbortSignal.timeout(this.timeout)]),i=Ws(),o=Ws();this.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n=Cm(t),o="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString()),s={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:n,signal:r};if(200!==(await fetch(o,s)).status)throw new $d("PUT ipns response had status other than 200","ERR_BAD_RESPONSE")}finally{r.clear(),o.resolve(),Vm("getIPNS finished: %c",e)}}}function Ym(e){var t;return"peer"===e.Schema?(e.ID=eg(e.ID),e.Addrs=e.Addrs.map(ng.HM),e.Protocols=null!==(t=e.Protocols)&&void 0!==t?t:[],e):"bitswap"===e.Schema?{Schema:"peer",ID:eg(e.ID),Addrs:e.Addrs.map(ng.HM),Protocols:null!=e.Protocol?[e.Protocol]:[]}:null!=e.ID&&Array.isArray(e.Addrs)?{Schema:"peer",ID:eg(e.ID),Addrs:e.Addrs.map(ng.HM),Protocols:Array.isArray(e.Protocols)?e.Protocols:[]}:void 0}function Jm(e,t){if("peer"===t.Schema&&(t.ID=eg(t.ID),t.Addrs=t.Addrs.map(ng.HM),e.equals(t.ID)))return t}function Xm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Qm(new URL(e),t)}var $m=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const ev=$m,tv=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class nv{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class rv{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ov(this,e)}}class iv{constructor(e){this.decoders=e}or(e){return ov(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const ov=(e,t)=>new iv({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class sv{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new nv(e,t,n),this.decoder=new rv(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const av=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new sv(t,n,r,i)},cv=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=ev(r,n);return av({prefix:t,name:n,encode:i,decode:e=>tv(o(e))})},lv=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return av({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},uv=cv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hv=cv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),dv=cv({prefix:"9",name:"base10",alphabet:"0123456789"}),fv=lv({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pv=lv({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),gv=lv({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),yv=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),mv=yv.reduce(((e,t,n)=>(e[n]=t,e)),[]),vv=yv.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const bv=av({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=mv[t]),"")},decode:function(e){const t=[];for(const n of e){const e=vv[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),wv=lv({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ev=lv({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Av=lv({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sv=lv({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_v=lv({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Iv=lv({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Cv=lv({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Tv=lv({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kv=lv({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Rv=cv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xv=cv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Pv=lv({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dv=lv({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ov=lv({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Nv=lv({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Bv=lv({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Lv=av({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Mv=new TextEncoder,Uv=new TextDecoder,Fv="json",Kv=512,jv=e=>Mv.encode(JSON.stringify(e)),Zv=e=>JSON.parse(Uv.decode(e)),zv="raw",Vv=85,Hv=e=>tv(e),qv=e=>tv(e);var Gv=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=Yv;)n[r++]=255&t|Wv,t/=128;for(;t&Qv;)n[r++]=255&t|Wv,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},Wv=128,Qv=-128,Yv=Math.pow(2,31);var Jv=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&$v)<<o:(r&$v)*Math.pow(2,o),o+=7}while(r>=Xv);return e.bytes=s-n,i},Xv=128,$v=127;var eb=Math.pow(2,7),tb=Math.pow(2,14),nb=Math.pow(2,21),rb=Math.pow(2,28),ib=Math.pow(2,35),ob=Math.pow(2,42),sb=Math.pow(2,49),ab=Math.pow(2,56),cb=Math.pow(2,63);const lb={encode:Gv,decode:Jv,encodingLength:function(e){return e<eb?1:e<tb?2:e<nb?3:e<rb?4:e<ib?5:e<ob?6:e<sb?7:e<ab?8:e<cb?9:10}},ub=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[lb.decode(e,t),lb.decode.bytes]},hb=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return lb.encode(e,t,n),t},db=e=>lb.encodingLength(e),fb=(e,t)=>{const n=t.byteLength,r=db(e),i=r+db(n),o=new Uint8Array(i+n);return hb(e,o,0),hb(n,o,r),o.set(t,i),new gb(e,n,t,o)},pb=e=>{const t=tv(e),[n,r]=ub(t),[i,o]=ub(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new gb(n,i,s,t)};class gb{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const yb=tv,mb={code:0,name:"identity",encode:yb,digest:e=>fb(0,yb(e))},vb=e=>{let{name:t,code:n,encode:r}=e;return new bb(t,n,r)};class bb{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fb(this.code,t):t.then((e=>fb(this.code,e)))}throw Error("Unknown type, must be binary type")}}const wb=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Eb=vb({name:"sha2-256",code:18,encode:wb("SHA-256")}),Ab=vb({name:"sha2-512",code:19,encode:wb("SHA-512")}),Sb=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?kb(n,Ib(e),t||uv.encoder):Rb(n,Ib(e),t||wv.encoder)},_b=new WeakMap,Ib=e=>{const t=_b.get(e);if(null==t){const t=new Map;return _b.set(e,t),t}return t};class Cb{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==xb)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Pb)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Cb.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=fb(e,t);return Cb.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return Cb.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return Sb(this,e)}toJSON(){return{"/":Sb(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Cb)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Cb(e,n,r,i||Db(e,n,r.bytes))}if(!0===t[Ob]){const{version:e,multihash:n,code:r}=t,i=pb(n);return Cb.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==xb)throw new Error("Version 0 CID must use dag-pb (code: ".concat(xb,") block encoding"));return new Cb(e,t,n,n.bytes);case 1:{const r=Db(e,t,n.bytes);return new Cb(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Cb.create(0,xb,e)}static createV1(e,t){return Cb.create(1,e,t)}static decode(e){const[t,n]=Cb.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Cb.inspectBytes(e),n=t.size-t.multihashSize,r=tv(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new gb(t.multihashCode,t.digestSize,i,r);return[0===t.version?Cb.createV0(o):Cb.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=ub(e.subarray(t));return t+=r,n};let r=n(),i=xb;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=Tb(e,t),i=Cb.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Ib(i).set(n,e),i}}const Tb=(e,t)=>{switch(e[0]){case"Q":{const n=t||uv;return[uv.prefix,n.decode("".concat(uv.prefix).concat(e))]}case uv.prefix:{const n=t||uv;return[uv.prefix,n.decode(e)]}case wv.prefix:{const n=t||wv;return[wv.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},kb=(e,t,n)=>{const{prefix:r}=n;if(r!==uv.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},Rb=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},xb=112,Pb=18,Db=(e,t,n)=>{const r=db(e),i=r+db(t),o=new Uint8Array(i+n.byteLength);return hb(e,o,0),hb(t,o,r),o.set(n,i),o},Ob=Symbol.for("@ipld/js-cid/CID"),Nb={...O,...T,...D,...I,...C,...R,...x,..._,...P,...k},Bb=Symbol.for("nodejs.util.inspect.custom"),Lb=Object.values(Nb).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Nb.identity.decoder),Mb=114,Ub=36,Fb=37;class Kb{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,fu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=uv.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Cb.createV1(Mb,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return function(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:Lb,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=pb(uv.decode("z".concat(e)));return e.startsWith("12D")?new Zb({multihash:t}):e.startsWith("16U")?new zb({multihash:t}):new jb({multihash:t})}return Vb(Lb.decode(e))}(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Bb](){return"PeerId(".concat(this.toString(),")")}}class jb extends Kb{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Zb extends Kb{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class zb extends Kb{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function Vb(e){try{const t=pb(e);if(t.code===mb.code){if(t.digest.length===Ub)return new Zb({multihash:t});if(t.digest.length===Fb)return new zb({multihash:t})}if(t.code===Eb.code)return new jb({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Mb)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Eb.code)return new jb({multihash:e.multihash});if(t.code===mb.code){if(t.digest.length===Ub)return new Zb({multihash:e.multihash});if(t.digest.length===Fb)return new zb({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Cb.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Hb=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const qb=Hb,Gb=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class Wb{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class Qb{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Jb(this,e)}}class Yb{constructor(e){this.decoders=e}or(e){return Jb(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const Jb=(e,t)=>new Yb({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Xb{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new Wb(e,t,n),this.decoder=new Qb(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $b=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new Xb(t,n,r,i)},ew=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=qb(r,n);return $b({prefix:t,name:n,encode:i,decode:e=>Gb(o(e))})},tw=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return $b({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},nw=ew({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rw=ew({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var iw=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=aw;)n[r++]=255&t|ow,t/=128;for(;t&sw;)n[r++]=255&t|ow,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},ow=128,sw=-128,aw=Math.pow(2,31);var cw=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&uw)<<o:(r&uw)*Math.pow(2,o),o+=7}while(r>=lw);return e.bytes=s-n,i},lw=128,uw=127;var hw=Math.pow(2,7),dw=Math.pow(2,14),fw=Math.pow(2,21),pw=Math.pow(2,28),gw=Math.pow(2,35),yw=Math.pow(2,42),mw=Math.pow(2,49),vw=Math.pow(2,56),bw=Math.pow(2,63);const ww={encode:iw,decode:cw,encodingLength:function(e){return e<hw?1:e<dw?2:e<fw?3:e<pw?4:e<gw?5:e<yw?6:e<mw?7:e<vw?8:e<bw?9:10}},Ew=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[ww.decode(e,t),ww.decode.bytes]},Aw=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ww.encode(e,t,n),t},Sw=e=>ww.encodingLength(e),_w=(e,t)=>{const n=t.byteLength,r=Sw(e),i=r+Sw(n),o=new Uint8Array(i+n);return Aw(e,o,0),Aw(n,o,r),o.set(t,i),new Cw(e,n,t,o)},Iw=e=>{const t=Gb(e),[n,r]=Ew(t),[i,o]=Ew(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Cw(n,i,s,t)};class Cw{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const Tw=Gb,kw={code:0,name:"identity",encode:Tw,digest:e=>_w(0,Tw(e))},Rw=e=>{let{name:t,code:n,encode:r}=e;return new xw(t,n,r)};class xw{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?_w(this.code,t):t.then((e=>_w(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Pw=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Dw=Rw({name:"sha2-256",code:18,encode:Pw("SHA-256")}),Ow=Rw({name:"sha2-512",code:19,encode:Pw("SHA-512")});function Nw(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Au.B)(n,"base64url")}function Bw(e){const t=function(e,t){let n=(0,yu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(gu().jsbn.BigInteger)((0,Au.B)(t,"base16"),16)}function Lw(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}const Mw=32,Uw=64,Fw=32;function Kw(e,t){const n=new Uint8Array(Uw);for(let r=0;r<Fw;r++)n[r]=e[r],n[Fw+r]=t[r];return n}const jw=tw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Zw=tw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zw=tw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Vw=tw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Hw={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},qw={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function Gw(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=Hw.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",qw,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",qw,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,yu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",qw,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return jw.encode(r)}var Ww,Qw,Yw,Jw;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Ww||(Ww={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Qw||(Qw={})),function(e){e.codec=()=>bs(Qw)}(Ww||(Ww={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Ww.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Ww.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Yw||(Yw={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Ww.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Ww.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Jw||(Jw={}));class Xw{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=iE(e,Mw)}verify(e,t){return function(e,t,n){return ql.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Yw.encode({Type:Ww.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Dw.digest(this.bytes);return Lw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class $w{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=iE(e,Uw),this._publicKey=iE(t,Mw)}sign(e){return function(e,t){const n=e.subarray(0,Fw);return ql.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new Xw(this._publicKey)}marshal(){return this._key}get bytes(){return Jw.encode({Type:Ww.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=Dw.digest(this.bytes);let t;return Lw(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=kw.digest(this.public.bytes);return nw.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Gw(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function eE(e){if(e.length>Uw){const t=(e=iE(e,Uw+Mw)).subarray(0,Uw),n=e.subarray(Uw,e.length);return new $w(t,n)}const t=(e=iE(e,Uw)).subarray(0,Uw),n=e.subarray(Mw);return new $w(t,n)}function tE(e){return e=iE(e,Mw),new Xw(e)}async function nE(){const{privateKey:e,publicKey:t}=function(){const e=ql.utils.randomPrivateKey(),t=ql.getPublicKey(e);return{privateKey:Kw(e,t),publicKey:t}}();return new $w(e,t)}async function rE(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==Fw)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=ql.getPublicKey(t);return{privateKey:Kw(t,n),publicKey:n}}(e);return new $w(t,n)}function iE(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new fu.sv("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}const oE={"P-256":256,"P-384":384,"P-521":521};Object.keys(oE).join(" / ");function sE(e,t){return t.map((t=>Bw(e[t])))}async function aE(e){const t=[await Hw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await lE(e)],n=await cE({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function cE(e){if(null==e.privateKey||null==e.publicKey)throw new fu.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Hw.get().subtle.exportKey("jwk",e.privateKey),Hw.get().subtle.exportKey("jwk",e.publicKey)])}async function lE(e){return Hw.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function uE(e,t,n,r){const i=t?function(e){return gu().pki.setRsaPublicKey(...sE(e,["n","e"]))}(e):function(e){return gu().pki.setRsaPrivateKey(...sE(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Au.B)(n instanceof Uint8Array?n:n.subarray(),"ascii"),i);return(0,yu.m)(o,"ascii")}function hE(e){if("RSA"!==e.kty)throw new fu.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new fu.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,yu.m)(e.n,"base64url").length}const dE=8192;class fE{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await Hw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Hw.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new fu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.publicKeyToAsn1({n:Bw(e.n),e:Bw(e.e)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Yw.encode({Type:Ww.RSA,Data:this.marshal()}).subarray()}encrypt(e){return uE(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Dw.digest(this.bytes);return Lw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class pE{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new fu.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return _c(e)}(16)}sign(e){return async function(e,t){const n=await Hw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Hw.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new fu.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new fE(this._publicKey)}decrypt(e){return uE(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new fu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=gu().pki.privateKeyToAsn1({n:Bw(e.n),e:Bw(e.e),d:Bw(e.d),p:Bw(e.p),q:Bw(e.q),dP:Bw(e.dp),dQ:Bw(e.dq),qInv:Bw(e.qi)});return(0,yu.m)(gu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Jw.encode({Type:Ww.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Dw.digest(this.bytes);return Lw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(gu().util.ByteBuffer)(this.marshal()),n=gu().asn1.fromDer(t),r=gu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return gu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return Gw(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function gE(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Nw(n.n),e:Nw(n.e),d:Nw(n.d),p:Nw(n.p),q:Nw(n.q),dp:Nw(n.dP),dq:Nw(n.dQ),qi:Nw(n.qInv),alg:"RS256"}}(e);if(hE(t)>dE)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await aE(t);return new pE(n.privateKey,n.publicKey)}function yE(e){const t=function(e){const t=gu().asn1.fromDer((0,Au.B)(e,"ascii")),n=gu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Nw(n.n),e:Nw(n.e)}}(e);if(hE(t)>dE)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new fE(t)}async function mE(e){if(hE(e)>dE)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await aE(e);return new pE(t.privateKey,t.publicKey)}async function vE(e){if(e>dE)throw new fu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Hw.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await cE(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new pE(t.privateKey,t.publicKey)}function bE(e){try{Eh.ProjectivePoint.fromHex(e)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PUBLIC_KEY")}}class wE{constructor(e){(0,Yo.Z)(this,"_key",void 0),bE(e),this._key=e}verify(e,t){return function(e,t,n){const r=Dw.digest(n instanceof Uint8Array?n:n.subarray());if(Lw(r))return r.then((n=>{let{digest:r}=n;return Eh.verify(t,r,e)})).catch((e=>{throw new fu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Eh.verify(t,r.digest,e)}catch(i){throw new fu.sv(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Eh.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Yw.encode({Type:Ww.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=Dw.digest(this.bytes);let t;return Lw(e)?({bytes:t}=await e):t=e.bytes,t}}class EE{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Eh.getPublicKey(e,!0)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Eh.getPublicKey(e,!0)}catch(t){throw new fu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),bE(this._publicKey)}sign(e){return function(e,t){const n=Dw.digest(t instanceof Uint8Array?t:t.subarray());if(Lw(n))return n.then((t=>{let{digest:n}=t;return Eh.sign(n,e).toDERRawBytes()})).catch((e=>{throw new fu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Eh.sign(n.digest,e).toDERRawBytes()}catch(r){throw new fu.sv(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new wE(this._publicKey)}marshal(){return this._key}get bytes(){return Jw.encode({Type:Ww.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Dw.digest(this.bytes);return Lw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Au.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Gw(this.bytes,e);throw new fu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function AE(e){return new EE(e)}function SE(e){return new wE(e)}async function _E(){const e=Eh.utils.randomPrivateKey();return new EE(e)}const IE={rsa:z,ed25519:Z,secp256k1:V};function CE(e){const t=Object.keys(IE).join(" / ");return new fu.sv("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function TE(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return IE[e];throw CE(e)}const kE=ew({prefix:"9",name:"base10",alphabet:"0123456789"}),RE=tw({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xE=tw({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),PE=tw({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),DE=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),OE=DE.reduce(((e,t,n)=>(e[n]=t,e)),[]),NE=DE.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const BE=$b({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=OE[t]),"")},decode:function(e){const t=[];for(const n of e){const e=NE[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),LE=tw({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ME=tw({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),UE=tw({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),FE=tw({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),KE=tw({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),jE=tw({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ZE=tw({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zE=tw({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),VE=tw({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),HE=ew({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qE=ew({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),GE=tw({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),WE=$b({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),QE=new TextEncoder,YE=new TextDecoder,JE="json",XE=512,$E=e=>QE.encode(JSON.stringify(e)),eA=e=>JSON.parse(YE.decode(e)),tA="raw",nA=85,rA=e=>Gb(e),iA=e=>Gb(e),oA=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?uA(n,aA(e),t||nw.encoder):hA(n,aA(e),t||LE.encoder)},sA=new WeakMap,aA=e=>{const t=sA.get(e);if(null==t){const t=new Map;return sA.set(e,t),t}return t};class cA{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==dA)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==fA)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return cA.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=_w(e,t);return cA.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return cA.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return oA(this,e)}toJSON(){return{"/":oA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof cA)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new cA(e,n,r,i||pA(e,n,r.bytes))}if(!0===t[gA]){const{version:e,multihash:n,code:r}=t,i=Iw(n);return cA.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==dA)throw new Error("Version 0 CID must use dag-pb (code: ".concat(dA,") block encoding"));return new cA(e,t,n,n.bytes);case 1:{const r=pA(e,t,n.bytes);return new cA(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return cA.create(0,dA,e)}static createV1(e,t){return cA.create(1,e,t)}static decode(e){const[t,n]=cA.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=cA.inspectBytes(e),n=t.size-t.multihashSize,r=Gb(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new Cw(t.multihashCode,t.digestSize,i,r);return[0===t.version?cA.createV0(o):cA.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Ew(e.subarray(t));return t+=r,n};let r=n(),i=dA;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=lA(e,t),i=cA.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return aA(i).set(n,e),i}}const lA=(e,t)=>{switch(e[0]){case"Q":{const n=t||nw;return[nw.prefix,n.decode("".concat(nw.prefix).concat(e))]}case nw.prefix:{const n=t||nw;return[nw.prefix,n.decode(e)]}case LE.prefix:{const n=t||LE;return[LE.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},uA=(e,t,n)=>{const{prefix:r}=n;if(r!==nw.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},hA=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},dA=112,fA=18,pA=(e,t,n)=>{const r=Sw(e),i=r+Sw(t),o=new Uint8Array(i+n.byteLength);return Aw(e,o,0),Aw(t,o,r),o.set(n,i),o},gA=Symbol.for("@ipld/js-cid/CID"),yA={...X,...G,...J,...H,...q,...Q,...Y,...U,...j,...W},mA=Symbol.for("nodejs.util.inspect.custom"),vA=Object.values(yA).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),yA.identity.decoder),bA=114,wA=36,EA=37;class AA{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,fu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=nw.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return cA.createV1(bA,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return function(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:vA,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Iw(nw.decode("z".concat(e)));return e.startsWith("12D")?new _A({multihash:t}):e.startsWith("16U")?new IA({multihash:t}):new SA({multihash:t})}return function(e){try{const t=Iw(e);if(t.code===kw.code){if(t.digest.length===wA)return new _A({multihash:t});if(t.digest.length===EA)return new IA({multihash:t})}if(t.code===Dw.code)return new SA({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==bA)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Dw.code)return new SA({multihash:e.multihash});if(t.code===kw.code){if(t.digest.length===wA)return new _A({multihash:e.multihash});if(t.digest.length===EA)return new IA({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(cA.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(vA.decode(e))}(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[mA](){return"PeerId(".concat(this.toString(),")")}}class SA extends AA{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class _A extends AA{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class IA extends AA{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}var CA;!function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(CA||(CA={}));const TA=async()=>{const e=await async function(e,t){return TE(e).generateKeyPair(null!==t&&void 0!==t?t:2048)}("Ed25519"),t=await kA(e);if("Ed25519"===t.type)return t;throw new Error('Generated unexpected PeerId type "'.concat(t.type,'"'))};async function kA(e){return async function(e,t){return e.length===wA?new _A({multihash:_w(kw.code,e),privateKey:t}):e.length===EA?new IA({multihash:_w(kw.code,e),privateKey:t}):new SA({multihash:await Dw.digest(e),publicKey:e,privateKey:t})}(function(e,t){var n;return TE(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}(e.public),function(e,t){var n;return TE(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}(e))}const RA=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};function xA(e){return null!=e[Symbol.asyncIterator]}const PA=e=>{const t=Bs.P$(e),n=(0,Us.E)(t);return Bs.cv(e,n),PA.bytes=t,n};function DA(e,t){var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:PA;function*o(e){const t=i(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return xA(e)?async function*(){for await(const t of e)yield*o(t)}():function*(){for(const t of e)yield*o(t)}()}PA.bytes=0,DA.single=(e,t)=>{var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:PA;return new Zs(i(e.byteLength),e)};var OA;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(OA||(OA={}));const NA=e=>{const t=Bs.Jx(e);return NA.bytes=Bs.P$(t),t};function BA(e,t){var n,r,i;const o=new Zs;let s=OA.LENGTH,a=-1;const c=null!==(n=null===t||void 0===t?void 0:t.lengthDecoder)&&void 0!==n?n:NA,l=null!==(r=null===t||void 0===t?void 0:t.maxLengthLength)&&void 0!==r?r:8,u=null!==(i=null===t||void 0===t?void 0:t.maxDataLength)&&void 0!==i?i:4194304;function*h(){for(;o.byteLength>0;){if(s===OA.LENGTH)try{if(a=c(o),a<0)throw Xo()(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(a>u)throw Xo()(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const e=c.bytes;o.consume(e),null!=(null===t||void 0===t?void 0:t.onLength)&&t.onLength(a),s=OA.DATA}catch(e){if(e instanceof RangeError){if(o.byteLength>l)throw Xo()(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(s===OA.DATA){if(o.byteLength<a)break;const e=o.sublist(0,a);o.consume(a),null!=(null===t||void 0===t?void 0:t.onData)&&t.onData(e),yield e,s=OA.LENGTH}}}return xA(e)?async function*(){for await(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw Xo()(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw Xo()(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}NA.bytes=0,BA.fromReader=(e,t)=>{let n=1;return BA(async function*(){for(;;)try{const{done:t,value:r}=await e.next(n);if(!0===t)return;null!=r&&(yield r)}catch(t){if("ERR_UNDER_READ"===t.code)return{done:!0,value:null};throw t}finally{n=1}}(),{...null!==t&&void 0!==t?t:{},onLength:e=>{n=e}})};const LA=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};const MA=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)yield t(n)}();const n=LA(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){yield await o;for await(const e of n)yield t(e)}();const s=t;return function*(){yield o;for(const e of n)yield s(e)}()};var UA;const FA=null!==(UA=globalThis.CustomEvent)&&void 0!==UA?UA:Event;function KA(e){try{let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(n){let r=null!==(n=t.concurrency)&&void 0!==n?n:1/0;r<1&&(r=1/0);const i=null!=t.ordered&&t.ordered,o=new EventTarget,s=[];let a,c=Ws(),l=Ws(),u=!1,h=!1;function d(){var e;return i?null===(e=s[0])||void 0===e?void 0:e.done:Boolean(s.find((e=>e.done)))}function*f(){for(;s.length>0&&s[0].done;){const e=s[0];if(s.shift(),!e.ok)throw h=!0,c.resolve(),e.err;yield e.value,c.resolve()}}function*p(){for(;d();)for(let e=0;e<s.length;e++)if(s[e].done){const t=s[e];if(s.splice(e,1),e--,!t.ok)throw h=!0,c.resolve(),t.err;yield t.value,c.resolve()}}for(o.addEventListener("task-complete",(()=>{l.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(s.length===r&&(c=Ws(),await c.promise),h)break;const e={done:!1};s.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new FA("task-complete"))}),(t=>{e.done=!0,e.err=t,o.dispatchEvent(new FA("task-complete"))}))}u=!0,o.dispatchEvent(new FA("task-complete"))}catch(t){a=t,o.dispatchEvent(new FA("task-complete"))}}));;){if(d()||(l=Ws(),await l.promise),null!=a)throw a;if(i?yield*f():yield*p(),u&&0===s.length)break}}()}catch(t){return Promise.reject(t)}}class jA{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class ZA{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new jA(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new jA(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class zA extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function VA(){return HA((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function HA(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new ZA,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new ZA,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new ZA,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new zA)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}const qA=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[];for(const i of t)null==i[Symbol.asyncIterator]&&r.push(i);return r.length===t.length?function*(){for(const e of r)yield*e}():async function*(){const e=VA({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(t.map((async t=>{for await(const n of t)e.push(n)}))),e.end()}catch(n){e.end(n)}})),yield*e}()};function GA(e){if(null==e)throw new Error("Empty pipeline");if(JA(e)){const t=e;e=()=>t.source}else if(YA(e)||QA(e)){const t=e;e=()=>t}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=[e,...n];if(i.length>1&&JA(i[i.length-1])&&(i[i.length-1]=i[i.length-1].sink),i.length>2)for(let o=1;o<i.length-1;o++)JA(i[o])&&(i[o]=XA(i[o]));return WA(...i)}const WA=function(){let e;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(;n.length>0;)e=n.shift()(e);return e},QA=e=>null!=(null===e||void 0===e?void 0:e[Symbol.asyncIterator]),YA=e=>null!=(null===e||void 0===e?void 0:e[Symbol.iterator]),JA=e=>null!=e&&(null!=e.sink&&null!=e.source),XA=e=>t=>{const n=e.sink(t);if(null!=(null===n||void 0===n?void 0:n.then)){const t=VA({objectMode:!0});let r;n.then((()=>{t.end()}),(e=>{t.end(e)}));const i=e.source;if(QA(i))r=async function*(){yield*i,t.end()};else{if(!YA(i))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");r=function*(){yield*i,t.end()}}return qA(t,r())}return e.source};var $A=n(27922);const eS="[a-fA-F\\d:]",tS=e=>e&&e.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(eS,")|(?<=").concat(eS,")(?=\\s|$))"):"",nS="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",rS="[a-fA-F\\d]{1,4}",iS="\n(?:\n(?:".concat(rS,":){7}(?:").concat(rS,"|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:").concat(rS,":){6}(?:").concat(nS,"|:").concat(rS,"|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:").concat(rS,":){5}(?::").concat(nS,"|(?::").concat(rS,"){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:").concat(rS,":){4}(?:(?::").concat(rS,"){0,1}:").concat(nS,"|(?::").concat(rS,"){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:").concat(rS,":){3}(?:(?::").concat(rS,"){0,2}:").concat(nS,"|(?::").concat(rS,"){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:").concat(rS,":){2}(?:(?::").concat(rS,"){0,3}:").concat(nS,"|(?::").concat(rS,"){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:").concat(rS,":){1}(?:(?::").concat(rS,"){0,4}:").concat(nS,"|(?::").concat(rS,"){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::").concat(rS,"){0,5}:").concat(nS,"|(?::").concat(rS,"){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),oS=new RegExp("(?:^".concat(nS,"$)|(?:^").concat(iS,"$)")),sS=new RegExp("^".concat(nS,"$")),aS=new RegExp("^".concat(iS,"$")),cS=e=>e&&e.exact?oS:new RegExp("(?:".concat(tS(e)).concat(nS).concat(tS(e),")|(?:").concat(tS(e)).concat(iS).concat(tS(e),")"),"g");cS.v4=e=>e&&e.exact?sS:new RegExp("".concat(tS(e)).concat(nS).concat(tS(e)),"g"),cS.v6=e=>e&&e.exact?aS:new RegExp("".concat(tS(e)).concat(iS).concat(tS(e)),"g");const lS=cS;var uS=n(54636),hS=n(87201),dS=n.n(hS);const{isValid:fS,parse:pS}=dS(),gS=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((e=>new $A.Netmask(e)));function yS(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}const mS=e=>{if(fS(e)){const t=pS(e);if("ipv4"===t.kind())return function(e){for(let t of gS)if(t.contains(e))return!0;return!1}(t.toNormalizedString());if("ipv6"===t.kind())return yS(e)}else if((0,uS.h6)(e)&&lS.v6().test(e))return yS(e)};var vS;!function(e){let t,n,r,i,o,s,a,c;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(n||(n={})),function(e){e.codec=()=>bs(n)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>bs(i)}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(o=e.PeerInfo||(e.PeerInfo={})),function(t){let n;t.codec=()=>(null==n&&(n=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.peer&&(n.uint32(10),e.PeerInfo.codec().encode(t.peer,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();if(n>>>3===1)r.peer=e.PeerInfo.codec().decode(t,t.uint32());else t.skipType(7&n)}return r}))),n),t.encode=e=>fs(e,t.codec()),t.decode=e=>ds(e,t.codec())}(s=e.Dial||(e.Dial={})),function(t){let n;t.codec=()=>(null==n&&(n=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.status&&(n.uint32(8),e.ResponseStatus.codec().encode(t.status,n)),null!=t.statusText&&(n.uint32(18),n.string(t.statusText)),null!=t.addr&&(n.uint32(26),n.bytes(t.addr)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.status=e.ResponseStatus.codec().decode(t);break;case 2:r.statusText=t.string();break;case 3:r.addr=t.bytes();break;default:t.skipType(7&n)}}return r}))),n),t.encode=e=>fs(e,t.codec()),t.decode=e=>ds(e,t.codec())}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==c&&(c=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.MessageType.codec().encode(t.type,n)),null!=t.dial&&(n.uint32(18),e.Dial.codec().encode(t.dial,n)),null!=t.dialResponse&&(n.uint32(26),e.DialResponse.codec().encode(t.dialResponse,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.MessageType.codec().decode(t);break;case 2:r.dial=e.Dial.codec().decode(t,t.uint32());break;case 3:r.dialResponse=e.DialResponse.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return r}))),c),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(vS||(vS={}));class bS{constructor(e,t){var n,r,i,o,s,a;(0,Yo.Z)(this,"components",void 0),(0,Yo.Z)(this,"startupDelay",void 0),(0,Yo.Z)(this,"refreshInterval",void 0),(0,Yo.Z)(this,"protocol",void 0),(0,Yo.Z)(this,"timeout",void 0),(0,Yo.Z)(this,"maxInboundStreams",void 0),(0,Yo.Z)(this,"maxOutboundStreams",void 0),(0,Yo.Z)(this,"verifyAddressTimeout",void 0),(0,Yo.Z)(this,"started",void 0),(0,Yo.Z)(this,"log",void 0),this.components=e,this.log=e.logger.forComponent("libp2p:autonat"),this.started=!1,this.protocol="/".concat(null!==(n=t.protocolPrefix)&&void 0!==n?n:"libp2p","/").concat("autonat","/").concat("1.0.0"),this.timeout=null!==(r=t.timeout)&&void 0!==r?r:3e4,this.maxInboundStreams=null!==(i=t.maxInboundStreams)&&void 0!==i?i:1,this.maxOutboundStreams=null!==(o=t.maxOutboundStreams)&&void 0!==o?o:1,this.startupDelay=null!==(s=t.startupDelay)&&void 0!==s?s:5e3,this.refreshInterval=null!==(a=t.refreshInterval)&&void 0!==a?a:6e4,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(e=>{this.handleIncomingAutonatStream(e).catch((e=>{this.log.error("error handling incoming autonat stream",e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=()=>{e.stream.abort(new fu.sv("handleIncomingAutonatStream timeout",fu.l9))};t.addEventListener("abort",n,{once:!0}),(0,fu.Wp)(1/0,t);const r=this.components.addressManager.getAddresses().map((e=>e.toOptions().host));try{const n=this;await GA(e.stream,(e=>BA(e)),(async function*(i){const o=await RA(i);if(null==o)return n.log("no message received"),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}}));let s;try{s=vS.decode(o)}catch(f){return n.log.error("could not decode message",f),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}}))}const a=s.dial;if(null==a)return n.log.error("dial was missing from message"),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}}));let c;const l=a.peer;if(null==l||null==l.id)return n.log.error("PeerId missing from message"),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}}));try{c=Vb(l.id)}catch(f){return n.log.error("invalid PeerId",f),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}))}if(n.log("incoming request from %p",c),!e.connection.remotePeer.equals(c))return n.log("target peer %p did not equal sending peer %p",c,e.connection.remotePeer),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}}));const u=l.addrs.map((e=>(0,ng.HM)(e))).filter((t=>{const r=t.toOptions().host===e.connection.remoteAddr.toOptions().host;return n.log.trace("request to dial %a was sent from %a is same host %s",t,e.connection.remoteAddr,r),r})).filter((e=>{var t;const r=e.toOptions().host,i=!(null!==(t=mS(r))&&void 0!==t&&t);return n.log.trace("host %s was public %s",r,i),i})).filter((e=>{const t=e.toOptions().host,i=!r.includes(t);return n.log.trace("host %s was not our host %s",t,i),i})).filter((e=>{const t=Boolean(n.components.transportManager.transportForMultiaddr(e));return n.log.trace("transport for %a is supported %s",e,t),t})).map((e=>(null==e.getPeerId()&&(e=e.encapsulate("/p2p/".concat(c.toString()))),e)));if(0===u.length)return n.log("no valid multiaddrs for %p in message",c),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}}));n.log("dial multiaddrs %s for peer %p",u.map((e=>e.toString())).join(", "),c);let h="",d=u[0];for await(const e of u){let r;d=e;try{if(r=await n.components.connectionManager.openConnection(e,{signal:t}),!r.remoteAddr.equals(e))throw n.log.error("tried to dial %a but dialed %a",e,r.remoteAddr),new Error("Unexpected remote address");return n.log("Success %p",c),void(yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.OK,addr:r.remoteAddr.decapsulateCode((0,ng.a_)("p2p").code).bytes}}))}catch(f){n.log("could not dial %p",c,f),h=f.message}finally{null!=r&&await r.close()}}yield vS.encode({type:vS.MessageType.DIAL_RESPONSE,dialResponse:{status:vS.ResponseStatus.E_DIAL_ERROR,statusText:h,addr:d.bytes}})}),(e=>DA(e)),e.stream)}catch(i){this.log.error("error handling incoming autonat stream",i)}finally{t.removeEventListener("abort",n)}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch((e=>{this.log.error("error verifying external address",e)}))}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;const e=this.components.addressManager,t=e.getObservedAddrs().filter((e=>{var t;const n=e.toOptions();return!(null!==(t=mS(n.host))&&void 0!==t&&t)}));if(0===t.length)return this.log("no public addresses found, not requesting verification"),void(this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval));const n=AbortSignal.timeout(this.timeout);(0,fu.Wp)(1/0,n);const r=this;try{this.log("verify multiaddrs %s",t.map((e=>e.toString())).join(", "));const o=vS.encode({type:vS.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:t.map((e=>e.bytes))}}}),s=(await TA()).toBytes(),a={},c=[],l=async e=>{let t=()=>{};try{this.log("asking %p to verify multiaddr",e.id);const i=await r.components.connectionManager.openConnection(e.id,{signal:n}),s=await i.newStream(this.protocol,{signal:n});t=()=>{s.abort(new fu.sv("verifyAddress timeout",fu.l9))},n.addEventListener("abort",t,{once:!0});const a=await GA([o],(e=>DA(e)),s,(e=>BA(e)),(async e=>RA(e)));if(null==a)return void this.log("no response received from %p",i.remotePeer);const l=vS.decode(a);if(l.type!==vS.MessageType.DIAL_RESPONSE||null==l.dialResponse)return void this.log("invalid autonat response from %p",i.remotePeer);if(l.dialResponse.status===vS.ResponseStatus.OK){const e=i.remoteAddr.toOptions();let t;if(4===e.family){t=e.host.split(".")[0]}else{if(6!==e.family)return void this.log('remote address "%s" was not IP4 or IP6?',e.host);t=e.host.split(":")[0]}if(c.includes(t))return void this.log("already have response from network segment %d - %s",t,e.host);c.push(t)}return l.dialResponse}catch(i){this.log.error("error asking remote to verify multiaddr",i)}finally{n.removeEventListener("abort",t)}};for await(const r of KA(MA(this.components.peerRouting.getClosestPeers(s,{signal:n}),(e=>async()=>l(e))),{concurrency:4}))try{if(null==r)continue;const n=null==r.addr?t[0]:(0,ng.HM)(r.addr);if(this.log("autonat response for %a is %s",n,r.status),r.status===vS.ResponseStatus.E_BAD_REQUEST)continue;if(r.status===vS.ResponseStatus.E_DIAL_REFUSED)continue;if(null==r.addr&&t.length>1)continue;if(!t.some((e=>e.equals(n)))){this.log("peer reported %a as %s but it was not in our observed address list",n,r.status);continue}const i=n.toString();if(null==a[i]&&(a[i]={success:0,failure:0}),r.status===vS.ResponseStatus.OK?a[i].success++:r.status===vS.ResponseStatus.E_DIAL_ERROR&&a[i].failure++,4===a[i].success)return this.log("%a is externally dialable",n),void e.confirmObservedAddr(n);if(4===a[i].failure)return this.log("%a is not externally dialable",n),void e.removeObservedAddr(n)}catch(i){this.log.error("could not verify external address",i)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function wS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new bS(t,e)}var ES=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const AS=ES,SS=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class _S{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class IS{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return TS(this,e)}}class CS{constructor(e){this.decoders=e}or(e){return TS(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const TS=(e,t)=>new CS({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class kS{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new _S(e,t,n),this.decoder=new IS(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const RS=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new kS(t,n,r,i)},xS=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=AS(r,n);return RS({prefix:t,name:n,encode:i,decode:e=>SS(o(e))})},PS=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return RS({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},DS=xS({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),OS=xS({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),NS=xS({prefix:"9",name:"base10",alphabet:"0123456789"}),BS=PS({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),LS=PS({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),MS=PS({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),US=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),FS=US.reduce(((e,t,n)=>(e[n]=t,e)),[]),KS=US.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const jS=RS({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=FS[t]),"")},decode:function(e){const t=[];for(const n of e){const e=KS[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),ZS=PS({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zS=PS({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),VS=PS({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),HS=PS({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qS=PS({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),GS=PS({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),WS=PS({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),QS=PS({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),YS=PS({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),JS=xS({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),XS=xS({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),$S=PS({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),e_=PS({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),t_=PS({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),n_=PS({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),r_=PS({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),i_=RS({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),o_=new TextEncoder,s_=new TextDecoder,a_="json",c_=512,l_=e=>o_.encode(JSON.stringify(e)),u_=e=>JSON.parse(s_.decode(e)),h_="raw",d_=85,f_=e=>SS(e),p_=e=>SS(e);var g_=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=v_;)n[r++]=255&t|y_,t/=128;for(;t&m_;)n[r++]=255&t|y_,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},y_=128,m_=-128,v_=Math.pow(2,31);var b_=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&E_)<<o:(r&E_)*Math.pow(2,o),o+=7}while(r>=w_);return e.bytes=s-n,i},w_=128,E_=127;var A_=Math.pow(2,7),S_=Math.pow(2,14),__=Math.pow(2,21),I_=Math.pow(2,28),C_=Math.pow(2,35),T_=Math.pow(2,42),k_=Math.pow(2,49),R_=Math.pow(2,56),x_=Math.pow(2,63);const P_={encode:g_,decode:b_,encodingLength:function(e){return e<A_?1:e<S_?2:e<__?3:e<I_?4:e<C_?5:e<T_?6:e<k_?7:e<R_?8:e<x_?9:10}},D_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[P_.decode(e,t),P_.decode.bytes]},O_=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return P_.encode(e,t,n),t},N_=e=>P_.encodingLength(e),B_=(e,t)=>{const n=t.byteLength,r=N_(e),i=r+N_(n),o=new Uint8Array(i+n);return O_(e,o,0),O_(n,o,r),o.set(t,i),new M_(e,n,t,o)},L_=e=>{const t=SS(e),[n,r]=D_(t),[i,o]=D_(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new M_(n,i,s,t)};class M_{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const U_=SS,F_={code:0,name:"identity",encode:U_,digest:e=>B_(0,U_(e))},K_=e=>{let{name:t,code:n,encode:r}=e;return new j_(t,n,r)};class j_{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?B_(this.code,t):t.then((e=>B_(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Z_=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),z_=K_({name:"sha2-256",code:18,encode:Z_("SHA-256")}),V_=K_({name:"sha2-512",code:19,encode:Z_("SHA-512")}),H_=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?Y_(n,G_(e),t||DS.encoder):J_(n,G_(e),t||ZS.encoder)},q_=new WeakMap,G_=e=>{const t=q_.get(e);if(null==t){const t=new Map;return q_.set(e,t),t}return t};class W_{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==X_)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==$_)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return W_.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multiha